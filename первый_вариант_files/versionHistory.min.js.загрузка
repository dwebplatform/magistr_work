var versionHistory=(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[23],{1482:function(e,t,r){"use strict";r.r(t);var o=r(1),n=r(53),i=r(55),s=r(221),a=function(){function e(){}return e.setDisabledChangeGates=function(t){t&&t.length>0?e.disabledChangeGates=t.toLowerCase().split(","):e.disabledChangeGates=[]},e.getDisabledChangeGates=function(){return e.disabledChangeGates.toString()},e.isChangeGateEnabled=function(t){return!(t.length<1)&&(e.disabledChangeGates.length<1||e.disabledChangeGates.indexOf(t.toLowerCase())<0)},e.disabledChangeGates=[],e}(),l=function(){function e(){}return e.UrlHydrationPrefetch="UrlHydrationPrefetch",e.FetchTelemetryChange="FetchTelemetryChange",e.FixFullAppErrorImage="FixFullAppErrorImage",e}(),c=function(e,t,r,o){this.correlationId=e||"",this.errorType=t,this.status=r,this.statusText=o},p=function(){function e(e,t,r,o){this._theUri="",this._serviceBase="",this._docId="",this._retryCount=3,this._wdEnableDownloadTokens=!1,this._handlerName="versions.ashx",this._handlerQueryParam="DocID",this._appId=0,this._userSessionId="",this._wacCluster="",this._latestStreamServiceBase="",this._useXhr=!1,this._wdEnableDeleteVersions=!1,this._serviceBase=e,this._docId=t,this._wdEnableDownloadTokens=!!r.wdEnableDownloadTokens&&r.wdEnableDownloadTokens,this._retryCount=r.retryCount?r.retryCount:3,this._appId=r.appName?r.appName:0,this._userSessionId=r.userSessionId?r.userSessionId:"",this._wacCluster=r.wacCluster?r.wacCluster:"",this._latestStreamServiceBase=o||"",this._useXhr=!!r.useXhr&&r.useXhr,this._wdEnableDeleteVersions=!!r.wdEnableDeleteVersions&&r.wdEnableDeleteVersions,this.buildVersionHistoryRequestUri()}return e.prototype.versionInfoFromTipVersion=function(e){try{if(!e)return;if(!e.data)return{data:null,errorCode:e.errorCode,message:e.message,isDirty:!1};var t={};return e.data.downloadUrl?(t.DownloadUrl=e.data.downloadUrl,{correlationID:e.correlationID,data:t,isDirty:"true"===e.data.isDirty}):(t.DownloadUrl=null,{data:t,errorCode:e.errorCode,message:"null download url",isDirty:!1})}catch(t){var r="versionInfoFromTipVersion exception: "+t.message;return n.a.sendTraceTag(579342617,i.a.msoulscat_Wac_VersionHistory,s.a.Error,r),{data:e.data,errorCode:138,message:r,isDirty:!1}}},e.prototype.getAppIdHeader=function(e){switch(e){case 120:return"Excel";case 100:return"PPT";case 110:return"Word"}return"None"},e.prototype.requestTipVersionAsync=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,t,r,a,l;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:e={method:"GET",headers:{"Content-Type":"application/json; charset=utf-8","X-AppId":this.getAppIdHeader(this._appId),"X-UserSessionId":this._userSessionId,"X-WacCluster":this._wacCluster}},t="&waccluster="+this._wacCluster,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.fetchRetry(this._latestStreamServiceBase+t,e,this._retryCount)];case 2:return r=o.sent(),[2,this.versionInfoFromTipVersion(r)];case 3:return a=o.sent(),l="requestTipVersionAsync fetchRetry exception: "+a.message,n.a.sendTraceTag(591934727,i.a.msoulscat_Wac_VersionHistory,s.a.Error,l),[2,{errorCode:128,message:l,isDirty:!1}];case 4:return[2]}}))}))},e.prototype.requestTipVersion=function(){return this.requestTipVersionAsync()},e.prototype.requestVersionHistory=function(){var e={method:"GET",headers:{"Content-Type":"application/json; charset=utf-8","X-AppId":this.getAppIdHeader(this._appId),"X-UserSessionId":this._userSessionId,"X-WacCluster":this._wacCluster,"X-WacNoAuth":"1"}},t="&wdEnableDownloadTokens="+this._wdEnableDownloadTokens.toString();return this._useXhr?this.xhrRetry(e.method,this._theUri+t,e.headers,null,this._retryCount):this.fetchRetry(this._theUri+t,e,this._retryCount)},e.prototype.requestDownloadToken=function(e,t){var r={method:"POST",headers:{"Content-Type":"application/json; charset=utf-8","X-AppId":this.getAppIdHeader(this._appId),"X-UserSessionId":this._userSessionId,"X-WacCluster":this._wacCluster,"X-WacNoAuth":"1"},body:JSON.stringify({RevisionIDs:e,OptionalIDs:t})},o="&action=GetDownloadToken&wdEnableDownloadTokens="+this._wdEnableDownloadTokens.toString();return this._useXhr?this.xhrRetry(r.method,this._theUri+o,r.headers,r.body,this._retryCount):this.fetchRetry(this._theUri+o,r,this._retryCount)},e.prototype.requestDeleteVersions=function(e){if(!e||0===e.length||e.includes(void 0)){return Promise.resolve({errorCode:135,message:"requestDeleteVersions: revisionIDs list is null."})}var t={method:"POST",headers:{"Content-Type":"application/json; charset=utf-8","X-AppId":this.getAppIdHeader(this._appId),"X-UserSessionId":this._userSessionId,"X-WacCluster":this._wacCluster,"X-WacNoAuth":"1"},body:JSON.stringify({RevisionIDs:e})},r="&action=DeleteVersions&wdEnableDeleteVersions="+this._wdEnableDeleteVersions.toString();return this._useXhr?this.xhrRetry(t.method,this._theUri+r,t.headers,t.body,1):this.fetchRetry(this._theUri+r,t,1)},e.prototype.buildVersionHistoryRequestUri=function(){this._serviceBase.indexOf(this._handlerName)<0?this._theUri=this._serviceBase+this._handlerName+"?"+this._handlerQueryParam+"="+encodeURIComponent(this._docId):this._theUri=this._serviceBase+"?"+this._handlerQueryParam+"="+encodeURIComponent(this._docId)},e.prototype.xhrRetry=function(t,r,p,d,u){return Object(o.__awaiter)(this,void 0,void 0,(function(){var h,g,m,f,v,y,b,C,S;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:g=!1,m="",f=1,v=0,y=0,b=0,o.label=1;case 1:if(!(b<u))return[3,7];a.isChangeGateEnabled(l.FetchTelemetryChange)&&(y+=1),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this.xhr(t,r,p,d)];case 3:return(h=o.sent())?(g=!1,f=0):(g=!0,f=133,m=a.isChangeGateEnabled(l.FetchTelemetryChange)?"VersionHistoryRequestManager::xhrRetry: unexpected null response from xhr, tryNumber: "+y+" of "+u:"xhrRetry: unexpected null response from xhr.",n.a.sendTraceTag(591934728,i.a.msoulscat_Wac_VersionHistory,a.isChangeGateEnabled(l.FetchTelemetryChange)?s.a.Warning:s.a.Error,m)),[3,5];case 4:return C=o.sent(),m=a.isChangeGateEnabled(l.FetchTelemetryChange)?"VersionHistoryRequestManager::xhrRetry xhr exception: ":"xhrRetry xhr exception: ",C instanceof c?(g=e.isRetriableError(C.errorType),f=C.errorType,m+=C.statusText,v=C.status):(g=!0,f=132,m+=C.message),a.isChangeGateEnabled(l.FetchTelemetryChange)&&(m+=", tryNumber: "+y+" of "+u+", isRetriableError: "+g),n.a.sendTraceTag(591934729,i.a.msoulscat_Wac_VersionHistory,a.isChangeGateEnabled(l.FetchTelemetryChange)?s.a.Warning:s.a.Error,m),[3,5];case 5:if(!g)return[3,7];o.label=6;case 6:return b+=1,[3,1];case 7:return a.isChangeGateEnabled(l.FetchTelemetryChange)&&(S=!h||0!==f,n.a.sendTraceTag(574128981,i.a.msoulscat_Wac_VersionHistory,S?s.a.Error:s.a.Info,"VersionHistoryRequestManager::xhrRetry exiting loop; tryNumber: "+y+" of "+u+", isError: "+S)),h?0!==f?[2,{errorCode:f,responseStatusCode:v,message:m,correlationId:h.headers.get("X-CorrelationId")}]:[2,h]:[2,{errorCode:f,message:m}]}}))}))},e.prototype.xhr=function(t,r,o,n){var i=this;return new Promise((function(s,a){var l=new XMLHttpRequest;l.open(t,r,!0),l.onload=function(){if(200===this.status)try{var t=JSON.parse(l.response);s({errorCode:0,data:t,correlationId:this.getResponseHeader("X-CorrelationId")})}catch(e){a(new c(this.getResponseHeader("X-CorrelationId"),131,this.status,"xhr: exception, statusText: "+this.statusText+", error: "+e.message))}else{var r=this.getResponseHeader("X-ErrorCode");a(new c(this.getResponseHeader("X-CorrelationId"),e.parseResponseError(this.status,null!=r?r:""),this.status,"xhr: failed, statusText: "+this.statusText+", X-ErrorCode: "+r))}},l.onerror=function(){var t=this.getResponseHeader("X-ErrorCode");a(new c(this.getResponseHeader("X-CorrelationId"),e.parseResponseError(this.status,null!=t?t:""),this.status,"xhr: onerror, statusText: "+this.statusText+", X-ErrorCode: "+t))},i.addXhrHeaders(o,l),l.send(n)}))},e.prototype.addXhrHeaders=function(e,t){if(e)for(var r in e)e.hasOwnProperty(r)&&t.setRequestHeader(r,e[r])},e.prototype.fetchRetry=function(t,r,c){return Object(o.__awaiter)(this,void 0,void 0,(function(){var p,d,u,h,g,m,f,v,y;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:p=null,d=1,u="",h=!1,g=0,m=0,o.label=1;case 1:if(!(m<c))return[3,7];a.isChangeGateEnabled(l.FetchTelemetryChange)&&(g+=1),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,fetch(t,r)];case 3:return(p=o.sent())?p.ok?h=!1:(h=e.isRetriableError(this.parseServerError(p)),u=a.isChangeGateEnabled(l.FetchTelemetryChange)?"VersionHistoryRequestManager::fetchRetry status: "+p.status+", statusText: "+p.statusText+", errorCode: "+e.getResponseErrorCode(p)+", correlationId: "+p.headers.get("X-CorrelationId")+", tryNumber: "+g+" of "+c+", isRetriableError: "+h:"fetchRetry status: "+p.status+", statusText: "+p.statusText+", errorCode: "+e.getResponseErrorCode(p)+", correlationId: "+p.headers.get("X-CorrelationId"),n.a.sendTraceTag(591934731,i.a.msoulscat_Wac_VersionHistory,a.isChangeGateEnabled(l.FetchTelemetryChange)?s.a.Warning:s.a.Error,u)):(h=!0,d=124,u=a.isChangeGateEnabled(l.FetchTelemetryChange)?"VersionHistoryRequestManager::fetchRetry: unexpected null response from fetch, tryNumber: "+g+" of "+c:"fetchRetry: unexpected null response from fetch.",n.a.sendTraceTag(591934730,i.a.msoulscat_Wac_VersionHistory,a.isChangeGateEnabled(l.FetchTelemetryChange)?s.a.Warning:s.a.Error,u)),[3,5];case 4:return f=o.sent(),h=!0,d=107,u=a.isChangeGateEnabled(l.FetchTelemetryChange)?"VersionHistoryRequestManager::fetchRetry fetch exception: "+f.message+"}, tryNumber: "+g+" of "+c:"fetchRetry fetch exception: "+f.message,n.a.sendTraceTag(591934732,i.a.msoulscat_Wac_VersionHistory,a.isChangeGateEnabled(l.FetchTelemetryChange)?s.a.Warning:s.a.Error,u),[3,5];case 5:if(!h)return[3,7];o.label=6;case 6:return m+=1,[3,1];case 7:if(a.isChangeGateEnabled(l.FetchTelemetryChange)&&(v=!p||1!==d,n.a.sendTraceTag(574128982,i.a.msoulscat_Wac_VersionHistory,v?s.a.Error:s.a.Info,"VersionHistoryRequestManager::fetchRetry exiting loop; tryNumber: "+g+" of "+c+", isError: "+v)),!p)return[2,{errorCode:d,message:u}];if(!p.ok)return[2,{errorCode:this.parseServerError(p),responseStatusCode:p.status,message:u,correlationId:p.headers.get("X-CorrelationId")}];o.label=8;case 8:return o.trys.push([8,10,,11]),[4,p.json()];case 9:return[2,{errorCode:0,data:o.sent(),correlationId:p.headers.get("X-CorrelationId")}];case 10:return y=o.sent(),u="fetchRetry response.json exception: "+y.message+", status: "+p.status+", statusText: "+p.statusText,n.a.sendTraceTag(591934733,i.a.msoulscat_Wac_VersionHistory,s.a.Error,u),[2,{errorCode:102,responseStatusCode:p.status,message:u,correlationId:p.headers.get("X-CorrelationId")}];case 11:return[2]}}))}))},e.prototype.parseServerError=function(t){var r;return e.parseResponseError(t.status,null!==(r=t.headers.get("X-ErrorCode"))&&void 0!==r?r:"")},e.parseResponseError=function(e,t){var r;switch(e){case 503:r=108;break;case 502:r=109;break;case 401:r=110;break;case 410:r=134}switch(t){case"VersioningNotEnabled":r=104;break;case"FileNotFound":r=105;break;case"VersionTooOld":r=106;break;case"FileNotFound":r=105;break;case"ServiceUnavailable":r=108;break;case"BadGateway":r=109;break;case"Unauthorized":r=110;break;case"InternalServerError":r=111;break;case"EmptyVersionMetadatas":r=112;break;case"FailedHostDownload":r=113;break;case"FailedToAddDownloadToVersionStore":r=114;break;case"FailedToCacheParts":r=115;break;case"FailedToDownloadVersionMetadata":r=116;break;case"FailedToDownloadParts":r=117;break;case"InvalidDocID":r=118;break;case"MissingDocID":r=119;break;case"NullDocID":r=120;break;case"NullHashedDocID":r=121;break;case"NullGetDownloadAccessTokenRequest":r=122;break;case"FailedToDownloadVersionFromHost":r=123;break;default:r=1}return r},e.getResponseErrorCode=function(t){var r,o;return null!==(o=null!==(r=e.getResponseStatusError(t.status))&&void 0!==r?r:t.headers.get("X-ErrorCode"))&&void 0!==o?o:""},e.getResponseStatusError=function(e){switch(e){case 503:return"ServiceUnavailable";case 502:return"BadGateway";case 401:return"Unauthorized";case 410:return"Gone"}return null},e.isRetriableError=function(e){switch(e){case 104:case 105:case 134:case 106:case 118:case 119:case 120:case 121:case 121:return!1}return!0},e}(),d=["#0078d4","#4f6bed","#e3008c","#004e8c","#005b70","#750b1c","#0b6a0b","#8764b8","#a4262c","#038387","#c239b3","#d13438","#498205","#5c2e91","#ca5010","#986f0b","#881798","#8e562e"],u=function(){function e(){}return e.getInitialsColorFromName=function(e){if(!e)return this.getColorByIndex(0);for(var t=0;t<this.nameColorMap.length;t+=1){var r=this.nameColorMap[t];if(r.name===e)return this.getColorByIndex(r.colorIndex)}var o={name:e,colorIndex:this.getNextColorIndex()};return this.nameColorMap.push(o),this.getColorByIndex(o.colorIndex)},e.getNextColorIndex=function(){return this.currentColorIndex=(this.currentColorIndex+1)%d.length,this.currentColorIndex},e.getColorByIndex=function(e){return d[e%d.length]},e.currentColorIndex=0,e.nameColorMap=[],e}(),h=function(){function e(){}return Object.defineProperty(e,"UILocale",{get:function(){return null!=this.uiLocale&&""!==this.uiLocale?this.uiLocale:"en-us"},set:function(e){this.uiLocale=e},enumerable:!0,configurable:!0}),e.uiLocale="",e}();function g(e,t,r){return!(!e||null===t||null===r||e.length<=t||e.length<=r)&&(e.length-1!==t&&e.length-1!==r&&Intl.DateTimeFormat(h.UILocale,{month:"long",day:"numeric",year:"numeric"}).format(e[t].Time)===Intl.DateTimeFormat(h.UILocale,{month:"long",day:"numeric",year:"numeric"}).format(e[r].Time))}var m=function(){function e(e,t,r,o,n,i,s,a,l,c){this.Versions=[],this._isDisposed=!1,this._getCachedTokensCount=0,this._cachedTokensPrefetchCount=0,this._versionHistoryRequestManager=l||new p(n,i,s,a),this._versionHistoryReadyEvent=e,this._perfTelemetryInfos=c,this._downloadTokenReadyEvent=t,this._fullAppErrorEvent=r,this._tipVersionTokenReadyEvent=o}return e.prototype.getTipVersion=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,r,a,l,c,p,d;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:t=Date.now(),n.a.sendTraceTag(590144346,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,JSON.stringify({event:"getTipVersion: started",startTime:t})),null!=this._perfTelemetryInfos&&this._perfTelemetryInfos.push({TelemetryEventKey:"LoadTipVersionStart",TelemetryEventData:t.toString()}),r=Date.now(),a=0,this._tipVersionResponse=null,l=null,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._versionHistoryRequestManager.requestTipVersion()];case 2:return l=o.sent(),[3,4];case 3:return c=o.sent(),a=Date.now(),n.a.sendTraceTag(591934734,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getTipVersion:: requestTipVersion exception",error:c.message,startTime:t,duration:a-t,versionReqDuration:a-r})),[2,!1];case 4:return p=Date.now(),this._tipVersionResponse=l,null!=this._perfTelemetryInfos&&this._perfTelemetryInfos.push({TelemetryEventKey:"LoadTipVersionEnd",TelemetryEventData:Date.now().toString()}),l?l.data?l.data.DownloadUrl?(this.Versions&&this.Versions.length>0&&!this.Versions[0].DownloadUrl&&!l.isDirty?(n.a.sendTraceTag(595882755,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"Storing First Version Download Url, sending TipVersionTokenReadyEvent"),e.updateVersionInfo(this.Versions[0],l.data)):n.a.sendTraceTag(595882756,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"No Versions list, sending TipVersionTokenReadyEvent"),d=Date.now(),this.fireTipVersionTokenReadyEvent(l.data,l.correlationID),a=Date.now(),n.a.sendTraceTag(590144347,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,JSON.stringify({event:"getTipVersion: ended",error:"None",startTime:t,duration:a-t,versionReqDuration:p-r,eventFireDuration:a-d,versionCount:this.Versions.length})),[2,!0]):(n.a.sendTraceTag(591934737,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getTipVersion: !response.data.DownloadUrl",error:"null download url",startTime:t,duration:Date.now()-t,versionReqDuration:p-r})),[2,!1]):(n.a.sendTraceTag(591934736,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getTipVersion: !response.data",error:"errorCode: "+l.errorCode+", errorMessage: "+l.message,startTime:t,duration:Date.now()-t,versionReqDuration:p-r})),[2,!1]):(n.a.sendTraceTag(591934735,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getTipVersion: !response",error:"null response",startTime:t,duration:Date.now()-t,versionReqDuration:p-r})),[2,!1])}}))}))},e.prototype.getVersions=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,r,c,p,d,u,h,g,m,f,v,y,b=this;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:t=1,r=500,c=Date.now(),n.a.sendTraceTag(590144348,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,JSON.stringify({event:"getVersions: started",startTime:c})),null!=this._perfTelemetryInfos&&this._perfTelemetryInfos.push({TelemetryEventKey:"LoadVersionListStart",TelemetryEventData:c.toString()}),p=Date.now(),d=0,u=0,h=null,g=3,m=0,o.label=1;case 1:if(!(m<g))return[3,7];o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this._versionHistoryRequestManager.requestVersionHistory()];case 3:return h=o.sent(),[3,5];case 4:return f=o.sent(),d=Date.now(),this.fireFullAppErrorEvent(126),u=Date.now(),n.a.sendTraceTag(591934738,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getVersions: requestVersionHistory exception",error:f.message,startTime:c,duration:u-c,versionReqDuration:d-p,eventFireDuration:u-d})),[2,!1];case 5:if(!h||!h.data||h.data.Versions&&h.data.Versions[0])return[3,7];o.label=6;case 6:return m+=1,[3,1];case 7:return v=Date.now(),null!=this._perfTelemetryInfos&&this._perfTelemetryInfos.push({TelemetryEventKey:"LoadVersionListEnd",TelemetryEventData:Date.now().toString()}),h?h.data?h.data.Versions?h.data.Versions[0]?this._isDisposed?(n.a.sendTraceTag(590127842,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getVersions: this._isDisposed",error:"this object is disposed",startTime:c,duration:Date.now()-c,versionReqDuration:v-p})),[2,!1]):(this.Versions=h.data.Versions?h.data.Versions.filter((function(e){return e.Time=new Date(e.Time.toString())})):[],this.Versions.sort((function(e,t){return e&&t&&e.Time&&t.Time?t.Time.getTime()-e.Time.getTime():0})),this.Versions.forEach((function(t){return e.updateAuthorColorInfo(t)})),this.Versions.length>0&&(this.Versions[0].RevisionID&&!this.Versions[0].DownloadUrl&&this._tipVersionResponse&&this._tipVersionResponse.data.DownloadUrl&&!this._tipVersionResponse.isDirty&&(n.a.sendTraceTag(595882271,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"Using stored tip version as first version downloadurl"),this.Versions[0].DownloadUrl=this._tipVersionResponse.data.DownloadUrl,this.Versions[0].WopiInfo=this._tipVersionResponse.data.WopiInfo),d=Date.now(),a.isChangeGateEnabled(l.UrlHydrationPrefetch)&&this._cachedTokensPrefetchCount<t&&(y=[],setTimeout((function(){b.getDownloadToken(y,void 0).then((function(){}),(function(){}))}),r),this._cachedTokensPrefetchCount+=1,n.a.sendTraceTag(574660755,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"getVersions: prefetching cached URLs after version list request complete")),this.fireVersionsReadyEvent(this.Versions,h.correlationID)),u=Date.now(),n.a.sendTraceTag(590144349,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,JSON.stringify({event:"getVersions: ended",error:"None",startTime:c,duration:u-c,versionReqDuration:v-p,eventFireDuration:u-d,versionCount:this.Versions.length})),[2,!0]):(d=Date.now(),this.fireFullAppErrorEventWithDefaultCode(h.errorCode),u=Date.now(),n.a.sendTraceTag(595682910,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getVersions: !response.data.Versions[0]",error:"null Versions[0]",startTime:c,duration:u-c,versionReqDuration:v-p,eventFireDuration:u-d})),[2,!1]):(d=Date.now(),this.fireFullAppErrorEventWithDefaultCode(h.errorCode),u=Date.now(),n.a.sendTraceTag(595682909,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getVersions: !response.data.Versions",error:"null Versions",startTime:c,duration:u-c,versionReqDuration:v-p,eventFireDuration:u-d})),[2,!1]):(d=Date.now(),this.fireFullAppErrorEventWithDefaultCode(h.errorCode),u=Date.now(),n.a.sendTraceTag(591934740,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getVersions: !response.data",error:"errorCode: "+h.errorCode+", errorMessage: "+h.message,startTime:c,duration:u-c,versionReqDuration:v-p,eventFireDuration:u-d})),[2,!1]):(d=Date.now(),this.fireFullAppErrorEvent(129),u=Date.now(),n.a.sendTraceTag(591934739,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getVersions: !response",error:"null response",startTime:c,duration:u-c,versionReqDuration:v-p,eventFireDuration:u-d})),[2,!1])}}))}))},e.prototype.getDownloadToken=function(t,r){return Object(o.__awaiter)(this,void 0,void 0,(function(){var c,p,d,u,h,g,m,f,v=this;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:c=Date.now(),n.a.sendTraceTag(590144350,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,JSON.stringify({event:"getDownloadToken: started",startTime:c})),null!=this._perfTelemetryInfos&&t.length>0&&this._perfTelemetryInfos.push({TelemetryEventKey:"GetDownloadTokenStart",TelemetryEventData:c.toString()}),p=this.getOrderedOptionalTokenList(t),d=Date.now(),u=0,h=0,g=null,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._versionHistoryRequestManager.requestDownloadToken(t,p)];case 2:return g=o.sent(),this._getCachedTokensCount+=1,[3,4];case 3:return m=o.sent(),u=Date.now(),this.fireFullAppErrorEvent(127),h=Date.now(),n.a.sendTraceTag(591934741,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getDownloadToken: requestDownloadToken exception",error:m.message,startTime:c,duration:h-c,versionReqDuration:u-d,eventFireDuration:h-u})),[2,!1];case 4:return f=Date.now(),null!=this._perfTelemetryInfos&&t.length>0&&this._perfTelemetryInfos.push({TelemetryEventKey:"GetDownloadTokenEnd",TelemetryEventData:Date.now().toString()}),g?g.data?g.data.Versions&&g.data.Versions[0]?(r&&(r.correlationID=g.correlationID),this._isDisposed?(n.a.sendTraceTag(590127872,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getDownloadToken: this._isDisposed",error:"this object is disposed",startTime:c,duration:Date.now()-c,versionReqDuration:f-d})),[2,!1]):(g.data.Versions.forEach((function(t){if(t&&t.DownloadUrl){var o=v.Versions.filter((function(e){return e.RevisionID===t.RevisionID}));o[0]&&(o[0].DownloadUrl=t.DownloadUrl,null!==t.WopiInfo&&(o[0].WopiInfo=t.WopiInfo),r&&(r.baseVersion&&r.baseVersion.RevisionID===t.RevisionID?e.updateVersionInfo(r.baseVersion,t):r.currentVersion&&r.currentVersion.RevisionID===t.RevisionID&&e.updateVersionInfo(r.currentVersion,t)))}})),u=Date.now(),this.fireDownloadTokenReadyEvent(this.Versions,r),h=Date.now(),n.a.sendTraceTag(590144351,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,JSON.stringify({event:"getDownloadToken ended",error:"None",startTime:c,duration:h-c,versionReqDuration:f-d,eventFireDuration:h-u,versionCount:t.length})),[2,!0])):(a.isChangeGateEnabled(l.UrlHydrationPrefetch)&&g.data.Versions&&!g.data.Versions[0]&&0===t.length||(u=Date.now(),g&&g.errorCode?this.fireFullAppErrorEvent(g.errorCode):this.fireFullAppErrorEvent(101),h=Date.now(),g.data.Versions?n.a.sendTraceTag(590127843,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getDownloadToken: !response.data.Versions[0]",error:"null Versions[0]",startTime:c,duration:h-c,versionReqDuration:f-d,eventFireDuration:h-u})):n.a.sendTraceTag(595907533,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getDownloadToken: !response.data.Version",error:"null Versions",startTime:c,duration:h-c,versionReqDuration:f-d,eventFireDuration:h-u}))),[2,!1]):(u=Date.now(),this.fireFullAppErrorEventWithDefaultCode(g.errorCode),h=Date.now(),n.a.sendTraceTag(591934743,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getDownloadToken: !response.data",error:"errorCode: "+g.errorCode+", errorMessage: "+g.message,startTime:c,duration:h-c,versionReqDuration:f-d,eventFireDuration:h-u})),[2,!1]):(u=Date.now(),this.fireFullAppErrorEvent(130),h=Date.now(),n.a.sendTraceTag(591934742,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"getDownloadToken: !response",error:"null response",startTime:c,duration:h-c,versionReqDuration:f-d,eventFireDuration:h-u})),[2,!1])}}))}))},e.prototype.getOrderedOptionalTokenList=function(e){var t,r=this,o=[];if(!a.isChangeGateEnabled(l.UrlHydrationPrefetch)&&0===e.length)return o;t=a.isChangeGateEnabled(l.UrlHydrationPrefetch)?e.length>0?e[0]:"-1":e[0];var n=[],i=[],s=!1,c=-1,p=[];this.Versions.forEach((function(e,o){e.RevisionID===t?(s=!0,c=o):o>0&&!e.DownloadUrl&&!g(r.Versions,o,o-1)&&(s?n.push(e.RevisionID):i.unshift(e.RevisionID)),r._getCachedTokensCount<2&&p.length<15&&!e.DownloadUrl&&o!==c&&p.push(e.RevisionID)}));for(var d=0;d<1;d+=1){n.length>d&&!o.includes(n[d])&&o.push(n[d]),i.length>d&&!o.includes(i[d])&&o.push(i[d]);var u=c-1-d,h=c+1+d;u>=0&&!o.includes(this.Versions[u].RevisionID)&&!this.Versions[u].DownloadUrl&&o.push(this.Versions[u].RevisionID),c>=0&&h<this.Versions.length&&!o.includes(this.Versions[h].RevisionID)&&!this.Versions[h].DownloadUrl&&o.push(this.Versions[h].RevisionID)}return p.forEach((function(e){o.includes(e)||o.push(e)})),o},e.prototype.dispose=function(){this._isDisposed=!0,this.Versions=[]},e.prototype.deleteVersions=function(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,r,a,l;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:null!=this._perfTelemetryInfos&&this._perfTelemetryInfos.push({TelemetryEventKey:"DeleteVersionsStart",TelemetryEventData:Date.now().toString()}),r=[],o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._versionHistoryRequestManager.requestDeleteVersions(e)];case 2:return t=o.sent(),[3,4];case 3:return a=o.sent(),n.a.sendTraceTag(589312513,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"deleteVersions requestDeleteVersions exception: "+a.message),this.fireFullAppErrorEvent(136),[2,null];case 4:return null!=this._perfTelemetryInfos&&this._perfTelemetryInfos.push({TelemetryEventKey:"DeleteVersionsEnd",TelemetryEventData:Date.now().toString()}),t?t.data?t.data.Versions?(t.data.Versions.forEach((function(e){return(null==e?void 0:e.RevisionID)?r.push(e.RevisionID):void 0})),l=e.filter((function(e){return!r.includes(e)})),this.Versions=this.Versions.filter((function(e){return!e.RevisionID||!l.includes(e.RevisionID)})),[2,r]):(n.a.sendTraceTag(589312516,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"deleteVersions failed: !response.data.Versions"),this.fireFullAppErrorEventWithDefaultCode(t.errorCode),[2,null]):(n.a.sendTraceTag(589312515,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"deleteVersions: null response.data, errorCode: "+t.errorCode+", errorMessage: "+t.message),this.fireFullAppErrorEventWithDefaultCode(t.errorCode),[2,null]):(n.a.sendTraceTag(589312514,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"deleteVersions: unexpected null response."),this.fireFullAppErrorEvent(137),[2,null])}}))}))},e.prototype.fireTipVersionTokenReadyEvent=function(e,t){if(!this._isDisposed){var r={tipVersion:e,updatedVersions:this.Versions,containerDiv:document.getElementById("vhViewer"),correlationID:t};n.a.sendTraceTag(595882757,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"fireTipVersionTokenReadyEvent"),this._tipVersionTokenReadyEvent.fireEvent(r)}},e.prototype.fireVersionsReadyEvent=function(e,t){if(!this._isDisposed){var r={versions:e,containerDiv:document.getElementById("vhViewer"),correlationID:t};n.a.sendTraceTag(595914892,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"fireVersionsReadyEvent"),this._versionHistoryReadyEvent.fireEvent(r)}},e.prototype.fireDownloadTokenReadyEvent=function(e,t){if(!this._isDisposed){var r={updatedVersions:e,versionSelected:t};n.a.sendTraceTag(595907532,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"fireDownloadTokenReadyEvent"),this._downloadTokenReadyEvent.fireEvent(r)}},e.prototype.fireFullAppErrorEventWithDefaultCode=function(e){e?this.fireFullAppErrorEvent(e):(this.fireFullAppErrorEvent(100),n.a.sendTraceTag(577380355,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"VHFailedToLoadVersionList"))},e.prototype.fireFullAppErrorEvent=function(e){this._isDisposed||(n.a.sendTraceTag(595906849,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"fireFullAppErrorEvent, error code: "+e),this._fullAppErrorEvent.fireEvent(e))},e.updateVersionInfo=function(e,t){null!=e?null!=t?(e.DownloadUrl=t.DownloadUrl,e.WopiInfo=t.WopiInfo):n.a.sendTraceTag(595858567,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"updateVersionInfo, currentVersionInfo is null"):n.a.sendTraceTag(595858566,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"currentVersionInfo, currentVersionInfo is null")},e.updateAuthorColorInfo=function(e){e.Authors&&e.Authors.forEach((function(e){e&&(e.InitialsColor=u.getInitialsColorFromName(e.UserName))}))},e}(),f=function(){function e(){this._listeners=[]}return e.prototype.fireEvent=function(e){this._listeners.forEach((function(t){return t(e)}))},e.prototype.addListener=function(e){e&&this._listeners.push(e)},e.prototype.removeListener=function(e){this._listeners=this._listeners.filter((function(t){return t!==e}))},e}(),v=r(0),y=r(56),b=r(143),C=r(8),S=r(2),_=Object(C.c)((function(e){return{root:Object(S.eb)({backgroundColor:"#F3F3F3",display:"flex",flexFlow:"row",width:"100%",height:"100%",overflow:"auto",direction:e?"rtl":"ltr"}),dialog:Object(S.eb)({display:"flex",flexFlow:"row",width:"100%",height:"100%",minWidth:"1000px",minHeight:"200px"}),hidden:Object(S.eb)({display:"none"}),fullAppErrorDiv:Object(S.eb)({display:"flex",flexFlow:"column",width:"100%",height:"100%"})}})),D=r(35),V=r(1005),E=r(249),T=Object(C.c)((function(e,t,r){return void 0===e&&(e="#B7472A"),void 0===t&&(t=!1),{root:Object(S.eb)({display:"flex",flexFlow:"column",flexBasis:"22%",flexGrow:1,flexShrink:1.5,maxWidth:r?"338px":"280px",minWidth:r?"338px":"280px",height:"calc(100% - 2px)",border:"1px solid #DEDEDE",backgroundColor:"#EDEBE9"}),scrollRegion:Object(S.eb)({flexFlow:"column",overflowY:"auto",overflowX:"hidden",marginBottom:"40px",marginTop:r?"16px":""}),loadingDiv:Object(S.eb)({display:"flex",flexGrow:1,justifyContent:"center",alignItems:"center"}),loadingSpinner:Object(S.eb)({selectors:{"& .ms-Spinner-circle":{borderColor:"#dddddd",borderTopColor:e}}}),paneHeader:Object(S.eb)({width:r?"":"98px",color:"#505050",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:r?"15px":"14px",fontWeight:600,lineHeight:r?"17px":"19px",marginLeft:r?"12px":"11px",marginRight:r?"12px":"",marginTop:r?"14px":"16px",marginBottom:r?"4px":"10px"}),showChangesDiv:Object(S.eb)({display:t?"flex":"none",height:t?"":"0px",fontFamily:r?'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif':"inherit",fontSize:r?"12px":"inherit",fontWeight:r?600:"inherit",marginTop:r?"16px":"inherit"}),hidden:Object(S.eb)({display:"none"})}})),w=r(737),x={overflowWrap:"break-word",wordWrap:"break-word",wordBreak:"break-word",hyphens:"auto"},I=Object(C.c)((function(e,t,r,o){var n,i,s,a,l,c,p,d,u,h;return{root:Object(S.eb)({backgroundColor:t?e?"#D2D0CE":"#EDEBE9":e?"#A6A6A6":"#FFFFFF",marginLeft:t?"":"9px",marginRight:t?"":"9px",marginBottom:Object(w.b)()?"-3px":"",padding:t?"12px 0 12px 16px":"",display:"flex",flexFlow:"row",outline:"none",boxShadow:t&&e?(o?"inset -4px 0 0 ":"inset 4px 0 0 ")+r:"",selectors:(n={},n[S.l]={MsHighContrastAdjust:"none",backgroundColor:e?"Highlight":"ButtonFace",color:e?"HighlightText":"ButtonText",boxShadow:t&&e?(o?"inset -6px 0 0 ":"inset 6px 0 0 ")+(Object(w.b)()?"GrayText":"LinkText"):""},n[":focus"]={backgroundColor:t?e?"#D2D0CE":"#EDEBE9":e?"#A6A6A6":"#f8f8f8",padding:t?"11px 0 11px 15px":"",border:t?"1px solid #000000":"none",boxShadow:t&&e?(o?"inset -3px 0 0 ":"inset 3px 0 0 ")+r:"",selectors:(i={},i[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Highlight",color:"HighlightText",padding:t?"12px 0 12px 16px":"",border:t?"none":"",boxShadow:t&&e?(o?"inset -6px 0 0 ":"inset 6px 0 0 ")+(Object(w.b)()?"GrayText":"LinkText"):""},i)},n[":hover"]={backgroundColor:t?"#E1DFDD":"#f8f8f8",selectors:(s={},s[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Highlight",color:"HighlightText"},s)},n[":active"]={backgroundColor:t?"#C8C6C4":"",selectors:(a={},a[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Highlight"},a)},n)},x),cardMouseDownStyleForIE:Object(S.eb)({position:"relative",padding:"11px 0 11px 15px",boxShadow:t&&e?(o?"inset -3px 0 0":"inset 3px 0 0 ")+r:"",border:"1px solid #000000",selectors:{":hover":{backgroundColor:"#C8C6C4",selectors:(l={},l[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Highlight",color:"HighlightText",padding:"12px 0 12px 16px",boxShadow:t&&e?(o?"inset -6px 0 0 ":"inset 6px 0 0 ")+"GrayText":"",border:"none"},l)}}}),body:Object(S.eb)({width:"100%",display:"flex",flexFlow:"column",cursor:"pointer",selectors:(c={},c[S.l]={MsHighContrastAdjust:"none",color:"inherit"},c)}),author:Object(S.eb)({display:"inline-block",marginBottom:"8px"}),authorBold:Object(S.eb)({display:"inline-block",fontWeight:t?"inherit":"bold",marginTop:t?"":"8px"}),authorDiv:Object(S.eb)({display:"flex",flexFlow:"row",marginLeft:"16px",marginTop:"4px"}),miniAuthorDiv:Object(S.eb)({display:"flex",flexFlow:"row",marginLeft:"20px",marginRight:"20px",marginTop:"4px",selectors:(p={},p[S.l]={MsHighContrastAdjust:"none",color:"inherit"},p)}),authorName:Object(S.eb)({color:"#252423",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"11px",marginLeft:"6px",selectors:(d={},d[S.l]={MsHighContrastAdjust:"none",color:"inherit"},d)}),timestampContextMenuDiv:Object(S.eb)({display:"inline-block",width:"auto",color:"#252423",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontWeight:e?"600":"normal",fontSize:"13px",lineHeight:"17px",marginLeft:"16px",marginTop:"8px",selectors:(u={},u[S.l]={MsHighContrastAdjust:"none",color:"inherit"},u)}),contextMenuDiv:Object(S.eb)({display:"inline-flex",position:"relative",float:"right",marginRight:"12px",top:"",paddingTop:"1px",height:"16px",maxWidth:Object(w.b)()?"22px":"20px"}),timestampDiv:Object(S.eb)({display:"inline-block",height:"16px"}),groupContextMenuDiv:Object(S.eb)({display:"inline-block",position:"relative",float:"right",marginRight:"16px",height:"14px",maxWidth:Object(w.b)()?"22px":"14px"}),groupTimestampDiv:Object(S.eb)({display:"inline-block"}),groupTimestampMenuDiv:Object(S.eb)({display:"inline-block",width:"auto",color:"#252423",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontWeight:e?"600":"normal",fontSize:"11px",marginTop:"",marginLeft:t?"20px":"42px",marginRight:"",selectors:(h={},h[S.l]={MsHighContrastAdjust:"none",color:"inherit"},h)})}})),A=r(726);function H(e,t,r,o){void 0===o&&(o=!1);var a=t||new Date,l=(a.getTime()-e.getTime())/1e3,c=Math.floor((a.getTime()-6e4*a.getTimezoneOffset())/864e5),p=Math.floor((e.getTime()-6e4*e.getTimezoneOffset())/864e5),d=a.getTime()-(36e5*a.getHours()+6e4*a.getMinutes()+1e3*a.getSeconds())-(a.getDay()+6)%7*864e5,u=d-6048e5,h=u-6048e5,g=h-6048e5,m=A.namespace();if(m.setup({locale:F(),missingTranslation:"ignore"}),null!=r){if(e<=a){if(l<120)return{friendlyDateString:r.JustNow,friendlyGroupString:r.TodayVersionsLabel};if(l<3600){var f=Math.floor(l/60);return isNaN(f)?(n.a.sendTraceTag(594883874,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"Minutes ago is NaN, input date was: "+e.toUTCString()),{friendlyDateString:k(e),friendlyGroupString:r.TodayVersionsLabel}):{friendlyDateString:m(r.MinutesAgo,{mins:f}),friendlyGroupString:r.TodayVersionsLabel}}if(p===c){var v=Math.floor(l/3600);return isNaN(v)?(n.a.sendTraceTag(594883875,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"Hours ago is NaN, input date was: "+e.toUTCString()),{friendlyDateString:k(e),friendlyGroupString:r.TodayVersionsLabel}):{friendlyDateString:m(r.HoursAgo,{hours:v}),friendlyGroupString:r.TodayVersionsLabel}}if(p===c-1)return{friendlyDateString:o?r.YesterdayWithTime.replace("{0}",k(e)):r.YesterdayAt.replace("{0}",k(e)),friendlyGroupString:r.YesterdayVersionsLabel};if(e.getTime()>=d){if(o){var y=Intl.DateTimeFormat(F(),{weekday:"long"}).format(e);return{friendlyDateString:r.DateTimeComboNoAt.replace("{0}",y).replace("{1}",k(e)),friendlyGroupString:y}}return{friendlyDateString:r.DateTimeCombo.replace("{0}",Intl.DateTimeFormat(F(),{weekday:"long"}).format(e)).replace("{1}",k(e)),friendlyGroupString:r.ThisWeekVersionsLabel}}if(e.getTime()>=u)return o?R(e,r):{friendlyDateString:r.DateTimeCombo.replace("{0}",Intl.DateTimeFormat(F(),{month:"long",day:"numeric"}).format(e)).replace("{1}",k(e)),friendlyGroupString:r.LastWeekVersionsLabel};if(e.getTime()>=h&&e.getMonth()===a.getMonth())return o?R(e,r):{friendlyDateString:r.DateTimeCombo.replace("{0}",Intl.DateTimeFormat(F(),{month:"long",day:"numeric"}).format(e)).replace("{1}",k(e)),friendlyGroupString:r.TwoWeekVersionsLabel};if(e.getTime()>=g&&e.getMonth()===a.getMonth())return o?R(e,r):{friendlyDateString:r.DateTimeCombo.replace("{0}",Intl.DateTimeFormat(F(),{month:"long",day:"numeric"}).format(e)).replace("{1}",k(e)),friendlyGroupString:r.ThreeWeekVersionsLabel};if(function(e,t){return e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}(e,a))return o?R(e,r):{friendlyDateString:r.DateTimeCombo.replace("{0}",Intl.DateTimeFormat(F(),{month:"long",day:"numeric"}).format(e)).replace("{1}",k(e)),friendlyGroupString:r.ThisMonthVersionsLabel};if(function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()-1}(e,a))return o?R(e,r):{friendlyDateString:r.DateTimeCombo.replace("{0}",Intl.DateTimeFormat(F(),{month:"long",day:"numeric"}).format(e)).replace("{1}",k(e)),friendlyGroupString:r.LastMonthVersionsLabel};if(e.getFullYear()===a.getFullYear())return o?R(e,r):{friendlyDateString:r.DateTimeCombo.replace("{0}",Intl.DateTimeFormat(F(),{month:"long",day:"numeric"}).format(e)).replace("{1}",k(e)),friendlyGroupString:Intl.DateTimeFormat(F(),{month:"long"}).format(e)};if(o){var b=Intl.DateTimeFormat(F(),{month:"long",day:"numeric",year:"numeric"}).format(e);return{friendlyDateString:r.DateTimeComboNoAt.replace("{0}",b).replace("{1}",k(e)),friendlyGroupString:b}}return{friendlyDateString:r.DateTimeCombo.replace("{0}",Intl.DateTimeFormat(F(),{month:"long",day:"numeric",year:"numeric"}).format(e)).replace("{1}",k(e)),friendlyGroupString:Intl.DateTimeFormat(F(),{year:"numeric",month:"long"}).format(e)}}return{friendlyDateString:r.JustNow,friendlyGroupString:r.TodayVersionsLabel}}return n.a.sendTraceTag(595682912,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"localizedStrings is null. Version date: "+e.toUTCString()+", Now: "+a.toUTCString()),{friendlyDateString:Intl.DateTimeFormat(F(),{month:"long",day:"numeric",year:"numeric"}).format(e>a?a:e),friendlyGroupString:o?Intl.DateTimeFormat(F(),{month:"long",day:"numeric",year:"numeric"}).format(e>a?a:e):Intl.DateTimeFormat(F(),{year:"numeric",month:"long"}).format(e>a?a:e)}}function R(e,t){var r=Intl.DateTimeFormat(F(),{month:"long",day:"numeric"}).format(e);return{friendlyDateString:t.DateTimeComboNoAt.replace("{0}",r).replace("{1}",k(e)),friendlyGroupString:r}}function k(e){return Intl.DateTimeFormat(F(),{hour:"numeric",minute:"numeric"}).format(e)}function F(){return h.UILocale}var O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.__extends)(t,e),t.prototype.componentDidMount=function(){N.register(this)},t.prototype.componentWillUnmount=function(){N.unregister(this)},t.prototype.render=function(){return H(this.props.date,void 0,this.props.localizedStrings,this.props.isGroupUISupported).friendlyDateString},t}(v.PureComponent),N=new(function(){function e(){this.components=[]}return e.prototype.register=function(e){var t=this;this.components.push(e),void 0===this.timerId&&(this.timerId=window.setInterval((function(){return t.onTimerFired()}),6e4))},e.prototype.unregister=function(e){this.components=this.components.filter((function(t){return t!==e})),this.components.length||window.clearInterval(this.timerId)},e.prototype.onTimerFired=function(){this.components.forEach((function(e){return e.forceUpdate()}))},e}()),B=r(159),j=Object(C.c)((function(){var e,t;return{authorDiv:Object(S.eb)({display:"flex",flexFlow:"row",marginLeft:"16px",marginTop:"4px",selectors:(e={},e[S.l]={MsHighContrastAdjust:"none",color:"inherit"},e)}),authorName:Object(S.eb)({color:"#252423",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"11px",marginLeft:"6px",selectors:(t={},t[S.l]={MsHighContrastAdjust:"none",color:"inherit"},t)})}})),L=Object(C.c)((function(e){var t,r;return{authorRole:Object(S.eb)({fontWeight:"normal",fontSize:"12px",color:"#252423",selectors:(t={},t[S.l]={MsHighContrastAdjust:"none",color:"inherit"},t)}),authorName:Object(S.eb)({color:"#252423",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"12px",fontWeight:600,selectors:(r={},r[S.l]={MsHighContrastAdjust:"none",color:"inherit"},r)}),colorBlock:Object(S.eb)({backgroundColor:e,width:"8px",height:"8px",marginRight:"4px",display:"inline-block"})}})),M=r(1007),W=r(28),z=r(1708);function U(e,t){return e.EmailAddress===t.EmailAddress&&e.LogOnName===t.LogOnName&&e.UserName===t.UserName}function G(e){switch(e){case 2:return 4;case 3:return 2}return 0}function P(e,t){return t||e.GuestUserDisplayName}function q(e,t){return t||u.getInitialsColorFromName(e)}var K=v.memo((function(e){var t=j(),r=P(e.localizedStrings,e.name),o=q(r,e.color);return v.createElement("div",{key:e.key,className:t.authorDiv},v.createElement(M.a,{size:W.c.size16,coinSize:20,text:r,initialsColor:o,hidePersonaDetails:!0}),v.createElement("div",{className:t.authorName},r))})),X=v.memo((function(e){var t=P(e.localizedStrings,e.name),r=q(t,e.color),o=L(r),n=e.role?e.role:e.actionType?function(e,t){switch(e){case 1:return t.UserAction;case 4:return t.UserRenameAction;case 2:case 3:return t.UserRestoreAction}}(e.actionType,e.localizedStrings):void 0;if(n){var i=Object(z.a)(e.localizedStrings.UserActionComboString,(function(e){return"0"===e?v.createElement("span",{className:o.authorName},v.createElement("span",{className:o.colorBlock,"data-is-focusable":!1}),t):"1"===e?v.createElement("span",{className:o.authorRole},n):""}));return v.createElement("span",null,i)}var s=e.actionType?function(e,t){switch(e){case 5:return t.UserModifyRenameActions;case 6:case 7:return t.UserRestoreRenameActions}}(e.actionType,e.localizedStrings):void 0;if(s){i=Object(z.a)(s,(function(e){return"0"===e?v.createElement("span",{className:o.authorName},v.createElement("span",{className:o.colorBlock,"data-is-focusable":!1}),t):""}));return v.createElement("span",{className:o.authorRole},i)}return v.createElement("span",{className:o.authorName},v.createElement("span",{className:o.colorBlock}),t)})),J=r(235),Y=r(183),Z=r.n(Y),Q=Object(C.c)((function(e){var t,r;return{contextMenuButtonStyles:{rootHasMenu:{display:"inline-flex",position:"relative",height:"16px",width:"16px",padding:"0",selectors:(t={},t[S.l]={MsHighContrastAdjust:"none",color:"ButtonText",fill:"ButtonText"},t[":hover"]={selectors:(r={},r[S.l]={MsHighContrastAdjust:"none",color:"HighlightText",fill:"HighlightText"},r)},t),direction:e?"rtl":"ltr"},menuIcon:{width:"12px",margin:"0 2px"}},contextMenuItemStyles:{root:{fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"14px",fontWeight:"normal",height:"auto",width:"auto",direction:e?"rtl":"ltr"}}}}));function $(e,t){return void 0===t&&(t="versionHistorySprite"),t+"."+e}var ee=function(){function e(){}return e.isEnableMenu=function(t,r){return e.isSaveEnabled(t)||e.isDownloadEnabled(t)||e.isDeleteEnabled(t,r)},e.isSaveEnabled=function(e){return!e.disableSaveACopy&&e.wdEnableSaveACopy&&e.wdEnableSaveACopyOverFlowMenu},e.isDownloadEnabled=function(e){return!e.disableSaveACopy&&e.wdEnableDownloadVersion},e.isDeleteEnabled=function(e,t){return e.wdEnableDeleteVersions&&!t},e}(),te=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._contextMenuRef=v.createRef(),t}return Object(o.__extends)(t,e),t.prototype.render=function(){var e=Q(this.props.appSettings.isRtl),t=[];if(this.props.onSaveACopyClicked&&t.push({key:"vh-save-a-copy",name:this.props.localizedStrings.SaveACopy,styles:e.contextMenuItemStyles,onClick:this.props.onSaveACopyClicked}),this.props.onDownloadVersionClicked&&t.push({key:"vh-download-version",name:this.props.localizedStrings.Download,styles:e.contextMenuItemStyles,onClick:this.props.onDownloadVersionClicked}),this.props.onDeleteVersionsClicked&&t.push({key:"vh-delete-versions",name:this.props.localizedStrings.Delete,styles:e.contextMenuItemStyles,onClick:this.props.onDeleteVersionsClicked}),t.length<1)return null;var r={iconName:$(Z.a.Ellipsis_12)},o={items:t};return v.createElement(J.a,{id:"vh-context-menu",componentRef:this._contextMenuRef,styles:e.contextMenuButtonStyles,ariaLabel:this.props.localizedStrings.MoreOptions,title:this.props.localizedStrings.MoreOptions,menuProps:o,menuIconProps:r})},t.prototype.openMenu=function(){var e;null===(e=this._contextMenuRef.current)||void 0===e||e.openMenu()},t}(v.Component),re=r(97),oe=r(334),ne=function(e){function t(t){var r=e.call(this,t)||this;return r._root=v.createRef(),r._rootHTMLElement=null,r._contextMenu=v.createRef(),r.onFocus=function(){r._root.current&&(r._root.current.tabIndex=-1,r._root.current.focus(),r._rootHTMLElement||(r._rootHTMLElement=document.getElementById(r._root.current.id)),r._rootHTMLElement&&Object(B.b)(!0,r._rootHTMLElement))},r.onClick=function(){var e={currentVersion:r.props.currentVersion,baseVersion:r.props.baseVersion,noBaseToCompareTo:!r.props.baseVersion};r.props.onVersionSelectedAction(e),n.a.sendTraceTag(595632832,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"User manually selected a version"),Object(re.logUserAction)("VersionHistorySelectVersion")},r.onContextMenu=function(e){var t;e.preventDefault(),null===(t=r._contextMenu.current)||void 0===t||t.openMenu()},r.onKeyDownInCard=function(e){if(e.shiftKey&&(e.which||e.keyCode)===D.a.f10)return void r.onContextMenu(e);r.props.appSettings.wdEnableCompareVersionsByGroup&&(e.which===D.a.left&&!r.props.appSettings.isRtl||e.which===D.a.right&&r.props.appSettings.isRtl)&&r.props.onLeftButton&&r.props.onLeftButton()},r.onCardMouseDownHandlerForIE=function(){var e=I(r.props.isSelected,r.props.appSettings.wdEnableCompareVersionsByGroup,r.props.appColors.primary,r.props.appSettings.isRtl);r._root&&r._root.current&&r._root.current.classList.toggle(e.cardMouseDownStyleForIE)},r.onCardMouseUpHandlerForIE=function(){var e=I(r.props.isSelected,r.props.appSettings.wdEnableCompareVersionsByGroup,r.props.appColors.primary,r.props.appSettings.isRtl);r._root&&r._root.current&&(r._root.current.classList.toggle(e.cardMouseDownStyleForIE),r._root.current.focus())},r.onDownloadVersionClicked=function(){var e;r.props.onDownloadVersionSelectedAction&&(n.a.sendTraceTag(592316623,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"Download clicked."),r.props.onDownloadVersionSelectedAction(null!==(e=r.props.currentVersion.DownloadUrl)&&void 0!==e?e:""))},r.onSaveACopyClicked=function(){var e;r.props.onSaveACopySelectedAction&&(n.a.sendTraceTag(592065615,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"SaveACopy clicked."),r.props.onSaveACopySelectedAction(null!==(e=r.props.currentVersion.DownloadUrl)&&void 0!==e?e:""))},r.onDeleteVersionsClicked=function(){r.props.onDeleteVersionsSelectedAction&&r.props.currentVersion.RevisionID&&(n.a.sendTraceTag(590147736,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"DeleteVersions clicked."),r.props.onDeleteVersionsSelectedAction([r.props.currentVersion.RevisionID]))},r}return Object(o.__extends)(t,e),t.prototype.render=function(){var e=this;if(this.props.appSettings.wdEnableShowVersionEvents&&this.props.appSettings.wdEnableCompareVersionsByGroup)return this.renderWithEvents();var t=this.props,r=t.currentVersion,a=t.isSelected,l=t.ariaPosinset,c=t.ariaSetsize,p=I(a,this.props.appSettings.wdEnableCompareVersionsByGroup,this.props.appColors.primary,this.props.appSettings.isRtl);if(!r.Time)return n.a.sendTraceTag(595933193,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({msg:"Version missing timestamp or author",id:r.RevisionID})),!1;var d=[];r.Authors&&r.Authors.length>0?r.Authors.forEach((function(t){if(t){var o=r.RevisionID+"_"+Object(b.a)();e.props.appSettings.wdEnableCompareVersionsByGroup?d.push(v.createElement("div",{className:p.miniAuthorDiv},v.createElement(X,{key:o,name:t.UserName,color:t.InitialsColor,role:e.props.localizedStrings.UserAction,localizedStrings:e.props.localizedStrings}))):d.push(v.createElement(K,{key:o,name:t.UserName,color:t.InitialsColor,localizedStrings:e.props.localizedStrings}))}})):this.props.appSettings.wdEnableCompareVersionsByGroup?d.push(v.createElement("div",{className:p.miniAuthorDiv},v.createElement(X,{key:r.RevisionID,name:r.AuthorID,role:this.props.localizedStrings.UserAction,localizedStrings:this.props.localizedStrings}))):d.push(v.createElement(K,{key:r.RevisionID,name:r.AuthorID,localizedStrings:this.props.localizedStrings}));var u=v.createElement(O,{date:r.Time,localizedStrings:this.props.localizedStrings,isGroupUISupported:this.props.appSettings.wdEnableCompareVersionsByGroup});return this.props.appSettings.wdEnableCompareVersionsByGroup?v.createElement("div",Object(o.__assign)({ref:this._root,id:"vhCard"+this.props.currentVersion.RevisionID,onClick:this.onClick,className:p.root,"data-is-focusable":!0,"data-unique-id":this.props.currentVersion.RevisionID,"aria-selected":a,role:"treeitem","aria-posinset":l,"aria-setsize":c,onKeyDown:this.onKeyDownInCard},Object(oe.c)()?{onMouseDown:this.onCardMouseDownHandlerForIE,onMouseUp:this.onCardMouseUpHandlerForIE}:{}),v.createElement("div",{className:p.body},v.createElement("div",{className:p.groupTimestampMenuDiv},v.createElement("div",{className:p.groupTimestampDiv},u),this.isShowContextMenu()&&v.createElement("div",{className:p.groupContextMenuDiv},this.getVersionHistoryContextMenu())),v.createElement("div",{className:p.authorBold},d))):v.createElement("div",{ref:this._root,onClick:this.onClick,className:p.root,"data-is-focusable":!0,"data-unique-id":this.props.currentVersion.RevisionID,"aria-selected":a,role:"listitem","aria-posinset":l,"aria-setsize":c,onKeyDown:this.onKeyDownInCard},v.createElement("div",{className:p.body},v.createElement("div",{className:p.timestampContextMenuDiv},v.createElement("div",{className:p.timestampDiv},u),this.isShowContextMenu()&&v.createElement("div",{className:p.contextMenuDiv},this.getVersionHistoryContextMenu())),v.createElement("div",{className:p.author},d)))},t.prototype.renderWithEvents=function(){var e,t,r=this,a=this.props,l=a.currentVersion,c=a.isSelected,p=a.ariaPosinset,d=a.ariaSetsize,u=I(c,!0,this.props.appColors.primary,this.props.appSettings.isRtl),h=[],g=(t=[],(e=l).Authors&&e.Authors.length>0?e.Authors.forEach((function(e){e&&t.push({type:1,author:e})})):t.push({type:1,author:{UserName:e.AuthorID}}),e.Events&&e.Events.forEach((function(e){if(e&&e.Author){for(var r=!1,o=0,n=t;o<n.length;o++){var i=n[o];U(i.author,e.Author)&&(r=!0,i.type|=G(e.Type))}r||t.push({author:e.Author,type:G(e.Type)})}})),{time:e.Time,events:t});if(!g.time)return n.a.sendTraceTag(594367690,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({msg:"Version missing timestamp or author",id:l.RevisionID})),!1;g.events.forEach((function(e){if(e){var t=l.RevisionID+"_"+Object(b.a)();h.push(v.createElement("div",{className:u.miniAuthorDiv},v.createElement(X,{key:t,name:e.author.UserName,color:e.author.InitialsColor,actionType:e.type,localizedStrings:r.props.localizedStrings})))}}));var m=v.createElement(O,{date:g.time,localizedStrings:this.props.localizedStrings,isGroupUISupported:this.props.appSettings.wdEnableCompareVersionsByGroup});return v.createElement("div",Object(o.__assign)({ref:this._root,id:"vhCard"+this.props.currentVersion.RevisionID,onClick:this.onClick,className:u.root,"data-is-focusable":!0,"data-unique-id":this.props.currentVersion.RevisionID,"aria-selected":c,role:"treeitem","aria-posinset":p,"aria-setsize":d,onKeyDown:this.onKeyDownInCard},Object(oe.c)()?{onMouseDown:this.onCardMouseDownHandlerForIE,onMouseUp:this.onCardMouseUpHandlerForIE}:{}),v.createElement("div",{className:u.body},v.createElement("div",{className:u.groupTimestampMenuDiv},v.createElement("div",{className:u.groupTimestampDiv},m),this.isShowContextMenu()&&v.createElement("div",{className:u.groupContextMenuDiv},this.getVersionHistoryContextMenu())),v.createElement("div",{className:u.authorBold},h)))},t.prototype.isShowContextMenu=function(){return ee.isEnableMenu(this.props.appSettings,this.props.isTipVersion)&&this.props.isSelected},t.prototype.getVersionHistoryContextMenu=function(){return v.createElement(te,{ref:this._contextMenu,appSettings:this.props.appSettings,localizedStrings:this.props.localizedStrings,onDownloadVersionClicked:ee.isDownloadEnabled(this.props.appSettings)?this.onDownloadVersionClicked:void 0,onSaveACopyClicked:ee.isSaveEnabled(this.props.appSettings)?this.onSaveACopyClicked:void 0,onDeleteVersionsClicked:ee.isDeleteEnabled(this.props.appSettings,this.props.isTipVersion)?this.onDeleteVersionsClicked:void 0})},t}(v.Component),ie=r(529),se=Object(C.c)((function(e){var t;void 0===e&&(e="#B7472A");var r={height:"16px",width:"16px",color:"#303030",lineHeight:"16px",marginLeft:"auto",marginRight:"16px",marginTop:"16px",marginBottom:"4px",cursor:"pointer",selectors:(t={},t[S.l]={MsHighContrastAdjust:"none",color:"inherit",fill:"ButtonText"},t)};return{sectionName:Object(S.eb)({color:"#252423",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"12px",lineHeight:"16px",marginLeft:"16px",marginTop:"12px",marginBottom:"4px"}),versionCount:Object(S.eb)({color:e,fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"12px",fontWeight:"normal",lineHeight:"16px",marginTop:"12px",marginBottom:"4px",marginLeft:"auto",display:"none"}),sectionHeader:Object(S.eb)({display:"flex",width:"auto",fontWeight:600,selectors:{":focus":{fontWeight:"bold"}}}),expand:Object(S.eb)(Object(o.__assign)(Object(o.__assign)({},r),{display:"inline-block"})),collapse:Object(S.eb)(Object(o.__assign)(Object(o.__assign)({},r),{display:"none",marginLeft:"5px",marginTop:"11px"})),versionItemDiv:Object(S.eb)({display:"inline-block",width:"100%",padding:0,border:"none"})}})),ae=r(169),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._list=v.createRef(),t._id=Object(b.a)(),t._header=v.createRef(),t.getListItemKey=function(e,t){return e.RevisionID||""},t.getBaseVersion=function(e,t,r){var o=null;return t.forEach((function(n,i){n===e&&(i!==t.length-1?o=t[i+1]:i===t.length-1&&(o=r))})),o},t.onShouldVirtualize=function(){return!0},t._commonCardProps={localizedStrings:t.props.localizedStrings,onVersionSelectedAction:t.props.onVersionSelectedAction,onDownloadVersionSelectedAction:t.props.onDownloadVersionSelectedAction,onSaveACopySelectedAction:t.props.onSaveACopySelectedAction,onDeleteVersionsSelectedAction:t.props.onDeleteVersionsSelectedAction},t.onRenderListItem=function(e,r){if(void 0!==e){var n=se(t.props.appColors.primary);return v.createElement("div",{className:n.versionItemDiv},v.createElement(ne,Object(o.__assign)({currentVersion:e,baseVersion:t.getBaseVersion(e,t.props.versions,t.props.finalBaseVersion),isSelected:t.props.selectedVersionId===e.RevisionID,ariaPosinset:void 0!==r?r+1:0,ariaSetsize:t.props.versions.length,appSettings:t.props.appSettings,appColors:t.props.appColors,onLeftButton:void 0,isTipVersion:t.props.versions[0].RevisionID===e.RevisionID&&t.props.containsTip},t._commonCardProps)))}},t.onSectionIconClick=function(){t.isListVisible()?t.collapseSubsection():t.expandSubsection()},t.isListVisible=function(){var e=document.getElementById(t._id);return null!=e&&e.offsetWidth>0&&e.offsetHeight>0},t.onKeyDownInSectionHeader=function(e){e.which===D.a.left&&!t.props.appSettings.isRtl||e.which===D.a.right&&t.props.appSettings.isRtl?t.collapseSubsection():(e.which===D.a.right&&!t.props.appSettings.isRtl||e.which===D.a.left&&t.props.appSettings.isRtl)&&t.expandSubsection()},t.showElement=function(e){e&&(e.style.display="block")},t.hideElement=function(e){e&&(e.style.display="none")},t}return Object(o.__extends)(t,e),t.prototype.render=function(){var e=se(this.props.appColors.primary),t=this.props.versions,r=this.props.label+": "+this.versionCountString(t.length);return v.createElement(v.Fragment,null,t.length>0&&v.createElement("div",null,v.createElement("div",{className:e.sectionHeader,"data-is-focusable":!0,onKeyDown:this.onKeyDownInSectionHeader,"aria-label":r,role:"treeitem","aria-expanded":"true",ref:this._header},v.createElement("div",{className:e.sectionName},this.props.label),v.createElement("div",{className:e.versionCount,id:this._id+"verCount"},this.versionCountString(t.length)),v.createElement(ae.a,{id:this._id+"IconExpand",className:e.expand,iconName:$(Z.a.DownChevronMedium_20),onClick:this.onSectionIconClick}),v.createElement(ae.a,{id:this._id+"IconCollapse",className:e.collapse,iconName:$(Z.a.UpChevronMedium_20),onClick:this.onSectionIconClick})),v.createElement(ie.a,{id:this._id,ref:this._list,items:t,onRenderCell:this.onRenderListItem,onShouldVirtualize:this.onShouldVirtualize,getKey:this.getListItemKey,role:"list","aria-label":this.props.label})))},t.prototype.componentDidUpdate=function(){},t.prototype.expandSubsection=function(){this.showElement(document.getElementById(this._id)),this.hideElement(document.getElementById(this._id+"IconCollapse")),this.showElement(document.getElementById(this._id+"IconExpand")),this.hideElement(document.getElementById(this._id+"verCount"));var e=this._header.current;e&&e.setAttribute("aria-expanded","true")},t.prototype.collapseSubsection=function(){this.hideElement(document.getElementById(this._id)),this.showElement(document.getElementById(this._id+"IconCollapse")),this.hideElement(document.getElementById(this._id+"IconExpand")),this.showElement(document.getElementById(this._id+"verCount"));var e=this._header.current;e&&e.setAttribute("aria-expanded","false")},t.prototype.versionCountString=function(e){return 1===e?this.props.localizedStrings.SingleVersionText:e>1?this.props.localizedStrings.MultiVersionsText.replace("{0}",e.toString()):""},t}(v.PureComponent),ce=Object(C.c)((function(e,t,r){var n,i,s,a,l,c,p,d,u,h,g,m,f,v={height:"16px",width:"16px",color:"#303030",lineHeight:"16px",verticalAlign:"center",display:"none",cursor:"pointer"},y={display:"flex",width:"auto",padding:"16px 0 16px 12px",selectors:(n={},n[S.l]={MsHighContrastAdjust:"none",backgroundColor:e?"Highlight":"ButtonFace",color:e?"HighlightText":"ButtonText",fill:e?"HighlightText":"ButtonText"},n["svg > path.OfficeIconColors_m22"]={selectors:(i={},i[S.l]={MsHighContrastAdjust:"none",fill:e?"HighlightText !important":"ButtonText !important"},i)},n[":hover"]={backgroundColor:"#E1DFDD",selectors:(s={},s[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Highlight",color:"HighlightText",fill:"HighlightText"},s)},n[":hover svg > path.OfficeIconColors_m22"]={selectors:(a={},a[S.l]={MsHighContrastAdjust:"none",fill:"HighlightText !important"},a)},n[":focus"]={outline:"0",border:"1px solid #000000",boxShadow:e?(r?"inset -3px 0 0 ":"inset 3px 0 0 ")+t:"",padding:"15px 0 15px 11px",selectors:(l={},l[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Highlight",color:"HighlightText",fill:"HighlightText",boxShadow:e?(r?"inset -6px 0 0 ":"inset 6px 0 0 ")+(Object(w.b)()?"GrayText":"LinkText"):"",border:"none",padding:"16px 0 16px 12px"},l)},n[":focus svg > path.OfficeIconColors_m22"]={selectors:(c={},c[S.l]={MsHighContrastAdjust:"none",fill:"HighlightText !important"},c)},n[":active"]={backgroundColor:"#C8C6C4",selectors:(p={},p[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Highlight",color:"HighlightText",fill:"HighlightText"},p)},n[":active svg > path.OfficeIconColors_m22"]={selectors:(d={},d[S.l]={MsHighContrastAdjust:"none",fill:"HighlightText !important"},d)},n)};return{toggleSpan:Object(S.eb)({flexBasis:"16px",height:"16px",width:"16px"}),sectionName:Object(S.eb)({display:"inline-flex",color:"#252423",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"15px",fontWeight:"normal",selectors:(u={},u[S.l]={MsHighContrastAdjust:"none",color:"inherit"},u)}),sectionHeaderFocusBackground:Object(S.eb)({padding:"15px 0 15px 11px",boxShadow:e?(r?"inset -3px 0 0 ":"inset 3px 0 0 ")+t:"",backgroundColor:e?"#D2D0CE":"#EDEBE9",border:"1px solid #000000",selectors:(h={},h[S.l]={MsHighContrastAdjust:"none",boxShadow:e?(r?"inset -6px 0 0":"inset 6px 0 0 ")+(Object(w.b)()?"GrayText":"LinkText"):"",border:"none",padding:"16px 0 16px 12px"},h)},y),sectionHeader:Object(S.eb)({boxShadow:e?(r?"inset -4px 0 0 ":"inset 4px 0 0 ")+t:"",backgroundColor:e?"#D2D0CE":"#EDEBE9",selectors:(g={},g[S.l]={MsHighContrastAdjust:"none",boxShadow:e?(r?"inset -6px 0 0":"inset 6px 0 0 ")+(Object(w.b)()?"GrayText":"LinkText"):""},g)},y),sectionHeaderMouseDownStyleForIE:Object(S.eb)({position:"relative",padding:"15px 0 15px 11px",boxShadow:e?(r?"inset -3px 0 0 ":"inset 3px 0 0 ")+t:"",border:"1px solid #000000",selectors:{":hover":{backgroundColor:"#C8C6C4",selectors:(m={},m[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Highlight",color:"HighlightText",padding:"16px 0 16px 12px",boxShadow:e?(r?"inset -6px 0 0 ":"inset 6px 0 0 ")+"GrayText":"",border:"none"},m)}}}),sectionNameDiv:Object(S.eb)({width:"",flexBasis:"calc(100% - 20px)",color:"#252423",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"14px",verticalAlign:"center",lineHeight:"16px",cursor:"pointer",marginRight:"8px",marginLeft:"8px",selectors:(f={},f[S.l]={MsHighContrastAdjust:"none",color:"inherit"},f)}),currentVersionDiv:Object(S.eb)({fontSize:"12px",paddingTop:"4px",fontWeight:"normal",paddingBottom:"2px"}),authorsList:Object(S.eb)({fontSize:"12px",marginTop:"4px",fontWeight:"normal"}),expand:Object(S.eb)(Object(o.__assign)(Object(o.__assign)({},v),{display:"none"})),collapse:Object(S.eb)(Object(o.__assign)(Object(o.__assign)({},v),{display:"inline-block"})),versionList:Object(S.eb)({display:"none"}),contextMenuDiv:Object(S.eb)({display:"inline-block",position:"relative",float:"right",top:"",marginRight:"8px",height:"16px",width:"16px",maxWidth:Object(w.b)()?"22px":"16px"}),timestampDiv:Object(S.eb)({display:"inline-block"}),versionItemDiv:Object(S.eb)({display:"inline-block",width:"100%",padding:0,border:"none"})}})),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._list=v.createRef(),t._id=Object(b.a)(),t._header=v.createRef(),t._headerHTMLElement=null,t._groupVersion=void 0,t._isExpanded=!1,t._firstVersionCard=void 0,t._headerDescribedBy="",t._contextMenu=v.createRef(),t.isShowContextMenu=function(){return ee.isEnableMenu(t.props.appSettings,t.props.containsTip)&&t.props.selectedGroupName===t.props.label},t.onDownloadVersionClicked=function(){var e;n.a.sendTraceTag(593293320,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"Download clicked."),t.props.onDownloadVersionSelectedAction(null!==(e=t.props.currentSectionVersion.DownloadUrl)&&void 0!==e?e:"")},t.onSaveACopyClicked=function(){var e;n.a.sendTraceTag(591987292,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"Save a copy clicked."),t.props.onSaveACopySelectedAction(null!==(e=t.props.currentSectionVersion.DownloadUrl)&&void 0!==e?e:"")},t.onDeleteVersionsClicked=function(){n.a.sendTraceTag(590147735,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"DeleteVersions clicked.");var e=[];t.props.versions.forEach((function(t){return t.RevisionID?e.push(t.RevisionID):void 0})),t.props.onDeleteVersionsSelectedAction(e)},t.setDescribedBy=function(){t._isExpanded?t._headerDescribedBy="":t._headerDescribedBy=t._id+"DisplayString "+t._id+"AuthorList",t.props.containsTip&&(t._headerDescribedBy+=" "+t._id+"Tip"),t._header&&t._header.current&&t._header.current.setAttribute("aria-describedby",t._headerDescribedBy)},t.onSectionHeaderFocus=function(){var e=ce(t.props.selectedGroupName===t.props.label,t.props.appColors.primary,t.props.appSettings.isRtl);t._header&&t._header.current&&(t._header.current.className=e.sectionHeaderFocusBackground)},t.onSectionHeaderBlur=function(){var e=ce(t.props.selectedGroupName===t.props.label,t.props.appColors.primary,t.props.appSettings.isRtl);t._header&&t._header.current&&(t._header.current.className=e.sectionHeader)},t.onSectionHeaderMouseDownHandlerForIE=function(){var e=ce(t.props.selectedGroupName===t.props.label,t.props.appColors.primary,t.props.appSettings.isRtl);t._header&&t._header.current&&t._header.current.classList.toggle(e.sectionHeaderMouseDownStyleForIE)},t.onSectionHeaderMouseUpHandlerForIE=function(){var e=ce(t.props.selectedGroupName===t.props.label,t.props.appColors.primary,t.props.appSettings.isRtl);t._header&&t._header.current&&(t._header.current.classList.toggle(e.sectionHeaderMouseDownStyleForIE),t._header.current.focus())},t.renderToggleSpan=function(e){return v.createElement("span",{className:e.toggleSpan,role:"button",onClick:t.onSectionIconClick,"aria-expanded":t._isExpanded,"aria-label":t.props.localizedStrings.ExpandCollapseGroupButtonAriaLabel},v.createElement(ae.a,{id:t._id+"IconExpand",className:e.expand,iconName:$(Z.a.CommonControlChevronDown_16)}),v.createElement(ae.a,{id:t._id+"IconCollapse",className:e.collapse,iconName:$(t.props.appSettings.isRtl?Z.a.CommonControlChevronLeft_16:Z.a.CommonControlChevronRight_16)}))},t.renderVersionCardList=function(e){return v.createElement(ie.a,{id:t._id,className:e.versionList,ref:t._list,items:t.props.versions,onRenderCell:t.onRenderListItem,onShouldVirtualize:t.onShouldVirtualize,getKey:t.getListItemKey,role:"presentation"})},t.renderAndSetAuthorList=function(){var e=ce(t.props.selectedGroupName===t.props.label,t.props.appColors.primary,t.props.appSettings.isRtl),r=de(t.props.versions,t.props.localizedStrings,t.props.appSettings.wdEnableShowVersionEvents),o=[];switch(r.length){case 0:n.a.sendTraceTag(595644672,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"there were no authors to display");break;case 1:o=t.render1To4Authors(t.props.localizedStrings.OneUserAuthorList,r);break;case 2:o=t.render1To4Authors(t.props.localizedStrings.TwoUserAuthorList,r);break;case 3:o=t.render1To4Authors(t.props.localizedStrings.ThreeUserAuthorList,r);break;case 4:o=t.render1To4Authors(t.props.localizedStrings.FourUserAuthorList,r);break;default:o=Object(z.a)(t.props.localizedStrings.FivePlusUserAuthorList,(function(e){return"3"===e?(r.length-3).toString():t.renderAuthor(r[parseInt(e,10)])}))}return t._groupVersion&&(t._groupVersion.Authors=r),v.createElement("div",{id:t._id+"AuthorList",className:e.authorsList},o)},t.render1To4Authors=function(e,r){return Object(z.a)(e,(function(e){return t.renderAuthor(r[parseInt(e,10)])}))},t.renderAuthor=function(e){return v.createElement(X,{name:e.UserName,color:e.InitialsColor,localizedStrings:t.props.localizedStrings})},t.getListItemKey=function(e,t){return e.RevisionID||""},t.getBaseVersion=function(e,t,r){var o=null;return t.forEach((function(n,i){n===e&&(o=i!==t.length-1?t[i+1]:r)})),o},t.onShouldVirtualize=function(){return!0},t._commonCardProps={localizedStrings:t.props.localizedStrings,onVersionSelectedAction:t.props.onVersionSelectedAction},t.onRenderListItem=function(e,r){if(void 0!==e){var o=ce(t.props.selectedGroupName===t.props.label,t.props.appColors.primary,t.props.appSettings.isRtl),n=new ne({localizedStrings:t._commonCardProps.localizedStrings,currentVersion:e,baseVersion:t.getBaseVersion(e,t.props.versions,t.props.finalBaseVersion),isSelected:!t.props.selectedGroupName&&t.props.selectedVersionId===e.RevisionID,ariaPosinset:void 0!==r?r+1:0,ariaSetsize:t.props.versions.length,appSettings:t.props.appSettings,appColors:t.props.appColors,isTipVersion:0===r&&t.props.containsTip,onVersionSelectedAction:t._commonCardProps.onVersionSelectedAction,onLeftButton:t.programaticFocus,onDownloadVersionSelectedAction:t.props.onDownloadVersionSelectedAction,onSaveACopySelectedAction:t.props.onSaveACopySelectedAction,onDeleteVersionsSelectedAction:t.props.onDeleteVersionsSelectedAction});return 0===r&&(t._firstVersionCard=n),v.createElement("div",{className:o.versionItemDiv,role:"presentation"},n.render())}},t.onSectionIconClick=function(e){t.expandOrCollapseSubsection(!t.isListVisible()),e.stopPropagation()},t.onSectionClicked=function(){n.a.sendTraceTag(595632606,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"group section header manually selected"),Object(re.logUserAction)("VersionHistorySelectVersionGroup"),t.onSectionSelected()},t.onSectionSelected=function(){var e={currentVersion:t._groupVersion?t._groupVersion:t.props.currentSectionVersion,baseVersion:t.props.finalBaseVersion,groupName:t.props.label,noBaseToCompareTo:!t.props.finalBaseVersion};t.props.onVersionSelectedAction(e),t.isListVisible()&&t.expandOrCollapseSubsection(!1),t.props.appSettings.wdEnableDeleteVersions&&t.programaticFocus()},t.isListVisible=function(){var e=document.getElementById(t._id);return null!=e&&"block"===e.style.display},t.onContextMenu=function(e){var r;e.preventDefault(),null===(r=t._contextMenu.current)||void 0===r||r.openMenu()},t.onKeyDownInSectionHeader=function(e){if(e.shiftKey&&(e.which||e.keyCode)===D.a.f10)return void t.onContextMenu(e);e.which===D.a.left&&!t.props.appSettings.isRtl||e.which===D.a.right&&t.props.appSettings.isRtl?t.expandOrCollapseSubsection(!1):(e.which===D.a.right&&!t.props.appSettings.isRtl||e.which===D.a.left&&t.props.appSettings.isRtl)&&(t._isExpanded?t._firstVersionCard&&t._firstVersionCard.onFocus():t.expandOrCollapseSubsection(!0)),e.which===D.a.enter&&t.onSectionSelected()},t.programaticFocus=function(){t._header&&t._header.current&&(t._header.current.focus(),t._headerHTMLElement||(t._headerHTMLElement=document.getElementById(t._header.current.id)),t._headerHTMLElement&&Object(B.b)(!0,t._headerHTMLElement))},t.displayElement=function(e,t){t&&(t.style.display=e?"block":"none")},t}return Object(o.__extends)(t,e),t.prototype.render=function(){var e=ce(this.props.selectedGroupName===this.props.label,this.props.appColors.primary,this.props.appSettings.isRtl),t=this.props.versions;this._groupVersion=Object(o.__assign)({},this.props.currentSectionVersion);var r=this.renderAndSetAuthorList();this.props.selectedGroupName===this._groupVersion.RevisionID&&this.onSectionSelected(),this.setDescribedBy();var n="";return this.props.versions.forEach((function(e){n+="vhCard"+e.RevisionID+" "})),v.createElement(v.Fragment,null,t.length>0&&v.createElement("div",{id:this._id+"GroupDiv"},v.createElement("div",Object(o.__assign)({id:this._id+"GroupHeaderDiv",className:1===this.props.positionInSet?[e.sectionHeader,this.props.classNameForItemToBeDefaultFocused].join(" "):e.sectionHeader,onKeyDown:this.onKeyDownInSectionHeader,"aria-label":this.props.clickableGroupDisplayString,role:"treeitem","aria-expanded":"false",ref:this._header,"aria-level":1,"aria-owns":n,"aria-posinset":this.props.positionInSet,"aria-setsize":this.props.subsectionCount,"data-is-focusable":!0,onClick:this.onSectionClicked},Object(oe.c)()?{onMouseDown:this.onSectionHeaderMouseDownHandlerForIE,onMouseUp:this.onSectionHeaderMouseUpHandlerForIE}:{onFocus:this.onSectionHeaderFocus,onBlur:this.onSectionHeaderBlur},{"aria-describedby":this._headerDescribedBy,"aria-selected":this.props.selectedGroupName===this.props.label}),this.renderToggleSpan(e),v.createElement("div",{className:e.sectionNameDiv},v.createElement("div",{className:e.sectionName,id:this._id+"DisplayString"},v.createElement("div",{className:e.timestampDiv},this.props.clickableGroupDisplayString)),this.isShowContextMenu()&&v.createElement("div",{className:e.contextMenuDiv},v.createElement(te,{ref:this._contextMenu,appSettings:this.props.appSettings,localizedStrings:this.props.localizedStrings,onDownloadVersionClicked:ee.isDownloadEnabled(this.props.appSettings)?this.onDownloadVersionClicked:void 0,onSaveACopyClicked:ee.isSaveEnabled(this.props.appSettings)?this.onSaveACopyClicked:void 0,onDeleteVersionsClicked:ee.isDeleteEnabled(this.props.appSettings,this.props.containsTip)?this.onDeleteVersionsClicked:void 0})),this.props.containsTip&&v.createElement("div",{className:e.currentVersionDiv,id:this._id+"Tip"},this.props.localizedStrings.CurrentVersion),r)),this.renderVersionCardList(e)))},t.prototype.componentDidUpdate=function(){},t.prototype.expandOrCollapseSubsection=function(e){this.displayElement(!e,document.getElementById(this._id+"IconCollapse")),this.displayElement(!e,document.getElementById(this._id+"AuthorList")),this.displayElement(e,document.getElementById(this._id)),this.displayElement(e,document.getElementById(this._id+"IconExpand"));var t=this._header.current;t&&t.setAttribute("aria-expanded",e?"true":"false"),this._isExpanded=e,this.setDescribedBy(),e?n.a.sendTraceTag(595632607,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"group section expanded"):n.a.sendTraceTag(595632608,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"group section collapsed")},t}(v.PureComponent);function de(e,t,r){var o=[];return r?(e.forEach((function(e){if(e.Authors&&e.Authors.length>0)e.Authors.forEach((function(e){e&&(o.some((function(t){return U(t,e)}))||o.push(e))}));else{var r=P(t,e.AuthorID);if(o.some((function(e){return e.UserName===r})))return;var n={UserName:r};o.push(n)}e.Events&&e.Events.forEach((function(e){if(e&&e.Author){var t=e.Author;if(o.some((function(e){return U(e,t)})))return;o.push(t)}else;}))})),o):(e.forEach((function(e){if(e.Authors&&e.Authors.length>0)e.Authors.forEach((function(e){if(e)if(e.UserName){var r=P(t,e.UserName);if(o.some((function(e){return e.UserName===r})))return;o.push(e)}else{var n=P(t,e.UserName);if(!o.some((function(e){return e.UserName===n}))){var i={UserName:n};o.push(i)}}}));else{var r=P(t,e.AuthorID);if(o.some((function(e){return e.UserName===r})))return;var n={UserName:r};o.push(n)}})),o)}var ue=Object(C.c)((function(){return{nothingFoundRoot:Object(S.eb)({display:"flex",flex:"none",margin:"1px 8px"}),nothingFoundText:Object(S.eb)({padding:"14px",textAlign:"center",margin:"0 auto"})}})),he=r(387),ge=r(146),me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._nothingFoundId=Object(b.a)(),t}return Object(o.__extends)(t,e),t.prototype.render=function(){var e=this,t=ue(),r=this.props,a=r.localizedStrings,l=r.versions,c=[];l.forEach((function(t,r){var o=H(t.Time,void 0,a,e.props.appSettings.wdEnableCompareVersionsByGroup),n=o.friendlyGroupString,i=c.length,s=e.props.appSettings.wdEnableCompareVersionsByGroup&&i>0&&c[i-1].versions.length>0?c[i-1].startIndex:null;0===i?c.push({versions:[t],label:n,startIndex:r,clickableGroupDisplayString:o.friendlyDateString,finalBaseVersion:null,currentSectionVersion:t,containsTip:!0}):(e.props.appSettings.wdEnableCompareVersionsByGroup?g(l,s,r):c[i-1].label===n&&r!==l.length-1)?c[i-1].versions.push(t):(c[i-1].finalBaseVersion=t,c.push({versions:[t],label:r===l.length-1?n+"_2":n,startIndex:r,clickableGroupDisplayString:o.friendlyDateString,finalBaseVersion:null,currentSectionVersion:t,containsTip:!1}))})),this.props.selectedVersionId||n.a.sendTraceTag(587544262,i.a.msoulscat_Wac_VersionHistory,s.a.Info,JSON.stringify({msg:"Grouped section generated",versionCount:l.length,groupCount:c.length}));var p={selectedVersionId:this.props.selectedVersionId,localizedStrings:this.props.localizedStrings,appSettings:this.props.appSettings,appColors:this.props.appColors,onVersionSelectedAction:this.props.onVersionSelectedAction,onDownloadVersionSelectedAction:this.props.onDownloadVersionSelectedAction,onSaveACopySelectedAction:this.props.onSaveACopySelectedAction,onDeleteVersionsSelectedAction:this.props.onDeleteVersionsSelectedAction};return v.createElement(v.Fragment,null,l.length?v.createElement(he.a,{direction:ge.a.vertical},c.length>0&&c.map((function(t,r){return e.props.appSettings.wdEnableCompareVersionsByGroup?v.createElement(pe,Object(o.__assign)({key:t.label,label:t.label,clickableGroupDisplayString:t.clickableGroupDisplayString,versions:t.versions,finalBaseVersion:t.finalBaseVersion,currentSectionVersion:t.currentSectionVersion,selectedGroupName:e.props.selectedGroupName,containsTip:t.containsTip,positionInSet:r+1,subsectionCount:c.length,classNameForItemToBeDefaultFocused:e.props.classNameForItemToBeDefaultFocused},p)):v.createElement(le,Object(o.__assign)({key:t.label,label:t.label,versions:t.versions,finalBaseVersion:t.finalBaseVersion,containsTip:t.containsTip},p))}))):v.createElement("div",{className:t.nothingFoundRoot,tabIndex:0,"aria-labelledby":this._nothingFoundId,role:"note"},v.createElement("div",{className:t.nothingFoundText,id:this._nothingFoundId,"aria-hidden":!0},a.VersionHistoryTitle)))},t}(v.PureComponent),fe=r(524),ve=r(835),ye=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._ftzone=v.createRef(),t._paneDescribedById="versionHistoryPane",t._classNameForItemToBeDefaultFocused="classNameForItemToBeDefaultFocused",t.getToggleStyles=function(){return{root:{height:14,marginLeft:t.props.appSettings.wdEnableCompareVersionsByGroup?12:16},label:{fontSize:13,order:0,marginLeft:0,marginRight:5,marginBottom:4},pill:{width:32,height:14,borderRadius:7,marginBottom:1},thumb:{width:4,height:4,borderRadius:"50%"},text:{display:"none"}}},t.getToggleTheme=function(e){return{palette:{themePrimary:e.primary,themeSecondary:e.tint10,themeDark:e.shade10,neutralDark:e.shade20},semanticColors:{inputBackgroundChecked:e.tint10}}},t.renderStandardListView=function(){var e,r=T(t.props.appColors.primary,t.props.appSettings.wdEnableShowVersionChanges,t.props.appSettings.wdEnableCompareVersionsByGroup),n=t.props,i=n.paneLoading,s=n.versions,a=n.viewerLoading,l=n.viewerError,c=n.selectedVersionId,p=!!t.props.appSettings.wdEnableHiddenButtonsUntilVersionLoadComplete&&(a||l),d={localizedStrings:t.props.localizedStrings,selectedVersionId:t.props.selectedVersionId,onVersionSelectedAction:t.props.onVersionSelectedAction,appSettings:t.props.appSettings,appColors:t.props.appColors};return e=void 0!==t.props.appColors?v.createElement(ve.a,Object(o.__assign)({theme:Object(S.K)(t.getToggleTheme(t.props.appColors)),styles:t.getToggleStyles(),defaultChecked:!0,label:t.props.localizedStrings.ShowChangesText,inlineLabel:!0,onChange:t.onShowVersionChangesChange},t.props.appSettings.wdEnableCompareVersionsByGroup?{disabled:i||void 0===c||p}:{})):v.createElement(ve.a,Object(o.__assign)({styles:t.getToggleStyles(),defaultChecked:!0,label:t.props.localizedStrings.ShowChangesText,inlineLabel:!0,onChange:t.onShowVersionChangesChange},t.props.appSettings.wdEnableCompareVersionsByGroup?{disabled:i||void 0===c||p}:{})),v.createElement(v.Fragment,null,v.createElement("div",{className:r.paneHeader},d.localizedStrings.VersionHistoryTitle),v.createElement("div",{className:r.showChangesDiv},e),i?v.createElement("div",{className:r.loadingDiv},v.createElement(V.a,{className:r.loadingSpinner,size:E.a.large})):v.createElement("div",{className:r.scrollRegion},v.createElement(me,Object(o.__assign)({versions:s,selectedGroupName:t.props.selectedGroupName,classNameForItemToBeDefaultFocused:t._classNameForItemToBeDefaultFocused},d,{onDownloadVersionSelectedAction:t.props.onDownloadVersionSelectedAction,onSaveACopySelectedAction:t.props.onSaveACopySelectedAction,onDeleteVersionsSelectedAction:t.props.onDeleteVersionsSelectedAction}))))},t.focus=function(){return t._ftzone.current&&t._ftzone.current.focus()},t.onKeyDown=function(e){e.which!==D.a.up&&e.which!==D.a.down||e.preventDefault()},t.onShowVersionChangesChange=function(e,r){void 0!==r&&(r?n.a.sendTraceTag(595637793,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"Toggle Changes diffs turned on"):n.a.sendTraceTag(595637794,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"Toggle Changes diffs turned off"),t.props.onShowVersionChangesToggledAction(r))},t}return Object(o.__extends)(t,e),t.prototype.render=function(){var e=T(this.props.appColors.primary,this.props.appSettings.wdEnableShowVersionChanges,this.props.appSettings.wdEnableCompareVersionsByGroup),t=this.props.localizedStrings;return v.createElement(fe.a,{componentRef:this._ftzone,onKeyDown:this.onKeyDown,className:e.root,forceFocusInsideTrap:!1,isClickableOutsideFocusTrap:!0,ignoreExternalFocusing:!0,focusPreviouslyFocusedInnerElement:!0,disableFirstFocus:!0,firstFocusableSelector:this._classNameForItemToBeDefaultFocused,"aria-label":t.VersionHistoryTitle,"aria-describedby":this._paneDescribedById,role:"group","aria-roledescription":this.props.localizedStrings.PaneRoleDescription},this.renderStandardListView(),v.createElement("div",{id:this._paneDescribedById,className:e.hidden,"aria-hidden":!0},t.VersionHistoryTitle))},t}(v.PureComponent),be=r(184),Ce=r(389),Se=Object(C.c)((function(e,t,r,o,n,i,s){var a,l,c;return void 0===r&&(r="#B7472A"),void 0===o&&(o=!1),void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===s&&(s=!1),{root:Object(S.eb)({display:"flex",flexBasis:"78%",flexFlow:"column",minWidth:"400px",flexGrow:1.5,flexShrink:1,height:"100%"}),vhHeader:Object(S.eb)({height:"48px",width:"100%",backgroundColor:"#F4F3F1",display:"flex"}),vhViewer:Object(S.eb)({backgroundColor:"#EDEBE9",flexDirection:"column",flexGrow:1,width:"100%",display:e||t?"none":"flex",position:i?"relative":"static"}),backArrow:Object(S.eb)({height:"20px",width:"20px",color:"#4A4A4A",marginLeft:"8px",marginRight:"8px",minWidth:"20px",cursor:"pointer",selectors:(a={},a[S.l]={MsHighContrastAdjust:"none",fill:"ButtonText"},a)}),icon:Object(S.eb)({flex:"none",marginTop:"3px",width:"16px",height:"16px"}),backToDoc:Object(S.eb)({height:"16px",whiteSpace:"nowrap",color:"#4A4A4A",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"14px",lineHeight:"16px",cursor:"pointer",marginRight:"8px",selectors:(l={},l[S.l]={MsHighContrastAdjust:"none",color:"ButtonText"},l)}),unselectedVersion:Object(S.eb)({fontStyle:"italic"}),selectedVersionTime:Object(S.eb)({color:"#4A4A4A",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"14px",fontWeight:600,lineHeight:"16px",marginLeft:"10px",marginRight:"10px"}),changesText:Object(S.eb)({display:s?"flex":"none",height:"16px",color:"#4A4A4A",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"14px",lineHeight:"16px",marginLeft:"4px",marginRight:"4px"}),changesCountText:Object(S.eb)({display:s?"flex":"none",height:"16px",width:"fill-content",color:"#4A4A4A",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"14px",lineHeight:"16px",cursor:"pointer"}),iteratorIcon:Object(S.eb)({display:s?"flex":"none",height:"16px",width:"16px",color:"#4A4A4A",justifyContent:"center",lineHeight:"16px",marginLeft:"12px",marginRight:"12px",cursor:"pointer",selectors:(c={},c[S.l]={MsHighContrastAdjust:"none",fill:"ButtonText"},c)}),iteratorTooltip:Object(S.eb)({color:"#252423",fontFace:"ms-fontSize-Secondary12",paddingBottom:"4px",paddingLeft:"8px",paddingRight:"8px",paddingTop:"4px",shadow:"ms-depth-8"}),viewerNoSelection:Object(S.eb)({display:"flex",flexFlow:"column",alignItems:"center",backgroundColor:"#E4E4E4",color:"#4A4A4A",height:"100%",width:"100%",paddingTop:"20vh",boxSizing:"border-box",fontSize:"18px"}),viewerError:Object(S.eb)({display:t?"flex":"none",flexFlow:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#EDEBE9",height:"100%",width:"100%"}),viewerErrorMessage:Object(S.eb)({height:"16px",width:"371px",color:"#252423",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"12px",lineHeight:"16px",textAlign:"center",marginTop:"22px"}),loadingDiv:Object(S.eb)({display:e&&!t?"flex":"none",justifyContent:"center",alignItems:"center",backgroundColor:"#EDEBE9",height:"100%",width:"100%",flexFlow:"column"}),loadingSpinner:Object(S.eb)({selectors:{"& .ms-Spinner-circle":{borderColor:"#dddddd",borderTopColor:r}}}),hidden:Object(S.eb)({display:"none"}),saveACopyButton:Object(S.eb)({display:o?"flex":"none",lineHeight:"16px",marginLeft:"5px",marginRight:"5px",whiteSpace:"nowrap"}),restoreButton:Object(S.eb)({display:n?"flex":"none",lineHeight:"16px",marginLeft:"5px",marginRight:"5px"}),headerContent:Object(S.eb)({display:"flex",flexGrow:"1",justifyContent:"space-between",width:"100%",overflow:"auto"}),headerContentGroup:Object(S.eb)({display:"flex",justifyContent:"flex-start",alignItems:"center",marginLeft:"4px",marginRight:"4px"})}})),_e=r(313),De=Object(C.c)((function(e){var t,r,o,n,i,s;return{defaultButton:Object(S.eb)(Object(oe.c)()?{overflow:"visible"}:{},{color:e?e.primary:"",borderColor:e?"rgba(200, 198, 196, 1.0)":"",selectors:(t={},t[S.l]={MsHighContrastAdjust:"none",backgroundColor:"ButtonFace",color:"ButtonText",border:"1px solid ButtonText"},t[":hover"]={color:e?e.shade10:"",selectors:(r={},r[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Highlight",color:"HighlightText"},r)},t[":focus"]={borderColor:e?"black":"",selectors:(o={},o[S.l]={MsHighContrastAdjust:"none",borderColor:"ButtonText"},o)},t[":active"]={color:e?e.shade10:"",selectors:(n={},n[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Highlight",color:"HighlightText",borderColor:"ButtonText"},n)},t[":disabled"]={selectors:(i={},i[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Window",color:"GrayText",border:"1px solid GrayText"},i)},t[":focus::after"]={outline:e?"none !important":"",selectors:(s={},s[S.l]={MsHighContrastAdjust:"none",outline:"1px solid ButtonText !important"},s)},t)})}})),Ve=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.button=v.createRef(),t.focus=function(){if(t.button.current){t.button.current.focus();var e=document.getElementById(t.props.id);e&&Object(B.b)(!0,e)}},t}return Object(o.__extends)(t,e),t.prototype.render=function(){var e=De(this.props.appColors);return v.createElement(_e.a,{componentRef:this.button,text:this.props.text,className:[this.props.className,e.defaultButton].join(" "),id:this.props.id,onClick:this.props.onClick,disabled:this.props.isDisabled,ariaDescription:this.props.ariaDescribedBy})},t}(v.PureComponent),Ee=r(734),Te=r(47),we=Object(C.c)((function(){var e,t;return{backArrow:Object(S.eb)({height:"20px",width:"20px",color:"#4A4A4A",lineHeight:"16px",marginLeft:"19px",marginRight:"19px",marginTop:"16px",minWidth:"20px",cursor:"pointer",selectors:(e={},e[S.l]={MsHighContrastAdjust:"none",fill:"ButtonText"},e)}),fullAppError:Object(S.eb)({display:"flex",flexFlow:"column",justifyContent:"center",alignItems:"center",height:"100%",width:"100%",backgroundColor:"#FFFFFF"}),fullAppErrorTop:Object(S.eb)({height:"24px",width:"284px",color:"#252423",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"18px",fontWeight:"300",lineHeight:"24px",textAlign:"center",marginTop:"38px"}),fullAppErrorSub:Object(S.eb)({height:"32px",width:"239px",color:"#252423",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"12px",lineHeight:"16px",textAlign:"center",marginTop:"15px"}),fullAppErrorButtons:Object(S.eb)({display:"flex",flexFlow:"row",marginTop:"33px"}),vhHeader:Object(S.eb)({height:"48px",width:"100%",backgroundColor:"#F4F3F1",display:"flex"}),backToDoc:Object(S.eb)({height:"16px",width:"97px",color:"#4A4A4A",fontFamily:'"Segoe UI", "Segoe UI Web", Calibri, Helvetica, Arial, sans-serif',fontSize:"12px",lineHeight:"16px",marginTop:"16px",cursor:"pointer",selectors:(t={},t[S.l]={MsHighContrastAdjust:"none",color:"ButtonText"},t)}),errorButtons:Object(S.eb)({marginLeft:"5px",marginRight:"5px"})}})),xe=r(506),Ie=Object(C.c)((function(){var e,t,r,o;return{primaryButton:Object(S.eb)(Object(oe.c)()?{overflow:"visible"}:{},{minWidth:"auto",selectors:(e={},e[S.l]={MsHighContrastAdjust:"none",backgroundColor:"ButtonText",color:"ButtonFace",border:"1px solid ButtonFace"},e[":hover"]={selectors:(t={},t[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Highlight",color:"HighlightText",borderColor:"HighlightText"},t)},e[":active"]={selectors:(r={},r[S.l]={MsHighContrastAdjust:"none",backgroundColor:"Highlight",color:"HighlightText",borderColor:"HighlightText"},r)},e[":disabled"]={selectors:(o={},o[S.l]={MsHighContrastAdjust:"none",backgroundColor:"ButtonFace",color:"GrayText",border:"1px solid GrayText"},o)},e)})}})),Ae=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.button=v.createRef(),t.focus=function(){if(t.button.current){t.button.current.focus();var e=document.getElementById(t.props.id);e&&Object(B.b)(!0,e)}},t.getPrimaryButtonTheme=function(e){return{semanticColors:{primaryButtonBackground:e.primary,primaryButtonBackgroundHovered:e.shade10,primaryButtonBackgroundPressed:e.shade20}}},t}return Object(o.__extends)(t,e),t.prototype.render=function(){var e=Ie();return v.createElement(xe.a,{componentRef:this.button,text:this.props.text,theme:Object(S.K)(this.getPrimaryButtonTheme(this.props.appColors)),className:[this.props.primaryClassName,e.primaryButton].join(" "),id:this.props.id,onClick:this.props.onClick,disabled:this.props.isDisabled,ariaDescription:this.props.ariaDescribedBy})},t}(v.PureComponent);function He(e){var t;switch(e){case 120:t="xlsx";break;case 100:t="pptx";break;case 110:t="docx";break;default:return""}return"https://static2.sharepointonline.com/files/fabric/assets/brand-icons/document/svg/"+t+"_48x1_5.svg"}var Re,ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.__extends)(t,e),t.prototype.render=function(){if(a.isChangeGateEnabled(l.FixFullAppErrorImage))return 104===this.props.fullAppError?this.renderVersioningDisabled():this.renderGenericError();var e=this.props.appSettings.fileExtension?this.props.appSettings.fileExtension:"";return 104===this.props.fullAppError?this.renderVersioningDisabled(e):this.renderGenericError(e)},t.prototype.componentDidUpdate=function(){this.setFocusOnLoad()},t.prototype.componentDidMount=function(){this.setFocusOnLoad()},t.prototype.renderHeader=function(e){return v.createElement("div",{id:"vhHeader",className:e.vhHeader},v.createElement(ae.a,{id:"backArrow",className:e.backArrow,iconName:$(Z.a.ArrowBack_20),onClick:this.props.onCloseSelectedAction}),v.createElement("div",{id:"backToDoc",className:e.backToDoc,onClick:this.props.onCloseSelectedAction},this.props.localizedStrings.ReturnToDoc))},t.prototype.renderErrorImage=function(e){return a.isChangeGateEnabled(l.FixFullAppErrorImage)?v.createElement("img",{src:He(this.props.appSettings.appName),role:"presentation",alt:"",width:"62",height:"55"}):v.createElement("img",{src:"https://static2.sharepointonline.com/files/fabric/assets/brand-icons/document/svg/"+e+"_48x1_5.svg",role:"presentation",alt:"",width:"62",height:"55"})},t.prototype.renderVersioningDisabled=function(e){var t=we(),r=this.props.localizedStrings.VersioningDisabledError,o=this.props.localizedStrings.VersioningDisabledDetails;return this._primaryButtonForFocus=new Ae({text:this.props.localizedStrings.BackLabel,primaryClassName:t.errorButtons,id:"VHErrorBackButton",onClick:this.props.onCloseSelectedAction,isDisabled:!1,appColors:this.props.appColors,ariaDescribedBy:r}),v.createElement(v.Fragment,null,this.renderHeader(t),v.createElement("div",{className:t.fullAppError},a.isChangeGateEnabled(l.FixFullAppErrorImage)?this.renderErrorImage():this.renderErrorImage(e),v.createElement("div",{className:t.fullAppErrorTop}," ",r),v.createElement("div",{className:t.fullAppErrorSub},o),v.createElement("div",{className:t.fullAppErrorButtons},v.createElement(Ae,{text:this.props.localizedStrings.TryAgainLabel,primaryClassName:t.errorButtons,id:"VHTryAgainButton",onClick:this.props.getVersions,isDisabled:!0,appColors:this.props.appColors}),this._primaryButtonForFocus.render())))},t.prototype.renderGenericError=function(e){var t=we(),r=this.props.localizedStrings.FullAppErrorTextTop,o=this.props.localizedStrings.FullAppErrorTextSub;return this._primaryButtonForFocus=new Ae({text:this.props.localizedStrings.TryAgainLabel,primaryClassName:t.errorButtons,id:"VHTryAgainButton",onClick:this.props.getVersions,isDisabled:!1,appColors:this.props.appColors,ariaDescribedBy:r}),this._defaultButtonForFocus=new Ve({text:this.props.localizedStrings.BackLabel,id:"VHErrorBackButton",className:t.errorButtons,onClick:this.props.onCloseSelectedAction}),v.createElement(v.Fragment,null,this.renderHeader(t),v.createElement("div",{className:t.fullAppError},a.isChangeGateEnabled(l.FixFullAppErrorImage)?this.renderErrorImage():this.renderErrorImage(e),v.createElement("div",{className:t.fullAppErrorTop}," ",r),v.createElement("div",{className:t.fullAppErrorSub},o),v.createElement("div",{className:t.fullAppErrorButtons},this._primaryButtonForFocus.render(),this._defaultButtonForFocus.render())))},t.prototype.setFocusOnLoad=function(){this._primaryButtonForFocus&&this._primaryButtonForFocus.focus()},t}(v.PureComponent),Fe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._ftzoneRoot=v.createRef(),t._ftzoneHeader=v.createRef(),t._ftzoneViewer=v.createRef(),t._saveACopyButton=v.createRef(),t._headerId="VersionHistoryHeader",t.onSaveAsClick=function(){t.getVersionInfoFromId(t.props.selectedVersionId,t.props)&&t.props.onSaveACopySelectedAction(t.getVersionInfoFromId(t.props.selectedVersionId,t.props).Version.DownloadUrl)},t.renderHeader=function(){var e,r=t.props.appSettings.fileExtension?t.props.appSettings.fileExtension:"",o=!!t.getVersionInfoFromId(t.props.selectedVersionId,t.props),n=!!t.props.appSettings.wdEnableSaveACopy&&(!t.props.appSettings.wdEnableSaveACopyOverFlowMenu&&!t.props.appSettings.disableSaveACopy),i=!!t.props.appSettings.wdEnableRestore&&t.props.appSettings.wdEnableRestore,s=!!t.props.appSettings.wdEnableIterator&&t.props.appSettings.wdEnableIterator,a=t.props.appSettings.viewerRootPositionRelative,l=!!t.props.appSettings.wdEnableHiddenButtonsUntilVersionLoadComplete&&(t.props.viewerLoading||t.props.viewerError),c=s&&o&&t.props.totalChangesCount>=0&&t.props.currentChange<=t.props.totalChangesCount,p=Se(t.props.viewerLoading,t.props.viewerError,t.props.appColors.primary,n&&o,i&&o&&t.props.versions[0]&&t.props.selectedVersionId!==t.props.versions[0].RevisionID,a,c);e=o?v.createElement(O,{date:t.getVersionInfoFromId(t.props.selectedVersionId,t.props).Version.Time,localizedStrings:t.props.localizedStrings,isGroupUISupported:t.props.appSettings.wdEnableCompareVersionsByGroup}):t.props.appSettings.wdLoadBlankVersionOnOpen?v.createElement("div",null):v.createElement("div",null,t.props.localizedStrings.VersionHistoryTitle);var d=0===t.props.totalChangesCount?t.props.localizedStrings.IteratorNoChangesToolTip:"",u=0===t.props.totalChangesCount?d:t.props.localizedStrings.IteratorTotalChangesLabel.replace("{0}",t.props.localizedStrings.IteratorChangesCountLabel.replace("{0}",t.props.currentChange.toString()).replace("{1}",t.props.totalChangesCount.toString()));return t.createRenderHeader(r,p,l,s,d,u,e)},t.focus=function(){return t._ftzoneRoot.current&&t._ftzoneRoot.current.focus()},t.focusHeader=function(){return t._ftzoneHeader.current&&t._ftzoneHeader.current.focus()},t.focusViewer=function(){return t._ftzoneViewer.current&&t._ftzoneViewer.current.focus()},t.focusSaveACopy=function(){return t._saveACopyButton.current&&t._saveACopyButton.current.focus()},t.getVersionInfoFromId=function(e,t){if(e){var r=Object(be.e)(t.versions,(function(t){return t.RevisionID===e}));return r>=0?{Version:t.versions[r]}:void 0}},t.onRestoreClick=function(){t.getVersionInfoFromId(t.props.selectedVersionId,t.props)&&t.props.onRestoreVersionAction(t.getVersionInfoFromId(t.props.selectedVersionId,t.props).Version.RevisionID)},t.onBackArrowKeyDown=function(e){e.which!==D.a.enter&&e.which!==D.a.space||t.onBackToDocumentClicked()},t.onIteratorPrevKeyDown=function(e){e.which!==D.a.enter&&e.which!==D.a.space||t.onIteratorPrevClick()},t.onIteratorNextKeyDown=function(e){e.which!==D.a.enter&&e.which!==D.a.space||t.onIteratorNextClick()},t.onBackToDocumentClicked=function(){n.a.sendTraceTag(595632281,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"Back to Document clicked"),t.props.onCloseSelectedAction()},t.onIteratorNextClick=function(){t.props.totalChangesCount>0&&(n.a.sendTraceTag(595648670,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"Iterator Next clicked-current count:"+t.props.currentChange.toString()+" ,total count:"+t.props.totalChangesCount.toString()),t.props.onIteratorSelectedAction(!0))},t.onIteratorPrevClick=function(){t.props.totalChangesCount>0&&(n.a.sendTraceTag(595648671,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,"Iterator Previous clicked-current count:"+t.props.currentChange.toString()+" ,total count:"+t.props.totalChangesCount.toString()),t.props.onIteratorSelectedAction(!1))},t}return Object(o.__extends)(t,e),t.prototype.render=function(){var e=Se(this.props.viewerLoading,this.props.viewerError,this.props.appColors.primary);return v.createElement(v.Fragment,null,v.createElement(fe.a,{componentRef:this._ftzoneRoot,id:this._headerId,className:e.root,forceFocusInsideTrap:!1,isClickableOutsideFocusTrap:!0,ignoreExternalFocusing:!0,focusPreviouslyFocusedInnerElement:!1,disableFirstFocus:!0,"aria-label":this.props.localizedStrings.HeaderAriaLabel,role:"group","aria-roledescription":this.props.localizedStrings.PaneRoleDescription},this.renderHeader()))},t.prototype.createRenderHeader=function(e,t,r,o,n,i,s){return this.createRenderWithFocusTrapZone(e,t,r,o,n,i,s)},t.prototype.createRenderWithFocusTrapZone=function(e,t,r,o,n,i,s){var a=!!this.getVersionInfoFromId(this.props.selectedVersionId,this.props),l=this.props.appSettings.wdLoadBlankVersionOnOpen&&!this.props.paneLoading&&!a;return v.createElement(v.Fragment,null,v.createElement(fe.a,{componentRef:this._ftzoneHeader,id:"vhHeader",className:t.vhHeader,forceFocusInsideTrap:!1,isClickableOutsideFocusTrap:!0,ignoreExternalFocusing:!0,focusPreviouslyFocusedInnerElement:!1,disableFirstFocus:!0},this.renderHeaderComponents(t,r,n,i,s,o)),l?this.renderBlankLoadLabel(t):this.renderErrorHeader(t,e),v.createElement(fe.a,{componentRef:this._ftzoneViewer,className:t.vhViewer,forceFocusInsideTrap:!1,isClickableOutsideFocusTrap:!0,ignoreExternalFocusing:!0,focusPreviouslyFocusedInnerElement:!1,disableFirstFocus:!0},v.createElement("div",{id:"vhViewer",className:l?t.hidden:t.vhViewer,tabIndex:0})))},t.prototype.renderBackButtonSection=function(e){return v.createElement("div",{className:e.headerContentGroup,onClick:this.onBackToDocumentClicked,tabIndex:0,onKeyDown:this.onBackArrowKeyDown,role:"button"},v.createElement(ae.a,{id:"backArrow",className:e.backArrow,iconName:$(Z.a.ArrowBack_20)}),v.createElement("div",{id:"backToDoc",className:e.backToDoc,"aria-label":this.props.localizedStrings.ReturnToDoc},this.props.localizedStrings.ReturnToDoc))},t.prototype.renderSelectedVersionSection=function(e,t){return v.createElement(v.Fragment,null,v.createElement("div",{id:"selectedVersionTime",className:e.selectedVersionTime},t))},t.prototype.renderButtonsSection=function(e,t){return v.createElement(v.Fragment,null,v.createElement(Ve,{ref:this._saveACopyButton,text:this.props.localizedStrings.SaveACopy,className:e.saveACopyButton,id:"VHSaveACopyButton",onClick:this.onSaveAsClick,isDisabled:t,appColors:this.props.appColors}),v.createElement(Ve,{text:this.props.localizedStrings.RestoreLabel,className:e.restoreButton,id:"VHRestoreButton",onClick:this.onRestoreClick,isDisabled:t,appColors:this.props.appColors}))},t.prototype.iteratorBackIcon=function(){return this.props.appSettings.isRtl?Z.a.NextChevronPaddle_24:Z.a.BackChevronPaddle_24},t.prototype.iteratorNextIcon=function(){return this.props.appSettings.isRtl?Z.a.BackChevronPaddle_24:Z.a.NextChevronPaddle_24},t.prototype.renderIteratorSection=function(e,t,r,o){if(o){var n=0===this.props.totalChangesCount?this.props.localizedStrings.IteratorPreviousButtonNoChangesString:this.props.localizedStrings.IteratorPreviousButtonXChangesString.replace("{0}",this.props.totalChangesCount.toString());return v.createElement(v.Fragment,null,v.createElement("div",{id:"ChangesText",className:e.changesText},this.props.localizedStrings.IteratorChangesLabel),v.createElement(Ee.a,{content:0===this.props.totalChangesCount?t:this.props.localizedStrings.IteratorPreviousChangeButtonLabel,directionalHint:Te.DirectionalHint.topCenter,className:e.iteratorTooltip},v.createElement(ae.a,{id:"iterateBack",className:e.iteratorIcon,tabIndex:0,"aria-label":this.props.localizedStrings.IteratorPreviousChangeButtonLabel+" . "+n,role:"button",iconName:$(this.iteratorBackIcon()),onClick:this.onIteratorPrevClick,onKeyDown:this.onIteratorPrevKeyDown})),v.createElement("div",{id:"CountText",className:e.changesCountText,title:t,"aria-label":r},this.props.localizedStrings.IteratorChangesCountLabel.replace("{0}",this.props.currentChange.toString()).replace("{1}",this.props.totalChangesCount.toString())),v.createElement(Ee.a,{content:0===this.props.totalChangesCount?void 0:this.props.localizedStrings.IteratorNextChangeButtonLabel,directionalHint:Te.DirectionalHint.topCenter,className:e.iteratorTooltip},v.createElement(ae.a,{id:"iterateFront",className:e.iteratorIcon,title:t,"aria-label":this.props.localizedStrings.IteratorNextChangeButtonLabel,role:"button",tabIndex:0===this.props.totalChangesCount?void 0:0,iconName:$(this.iteratorNextIcon()),onClick:this.onIteratorNextClick,onKeyDown:this.onIteratorNextKeyDown})))}},t.prototype.renderHeaderComponents=function(e,t,r,o,n,i){return v.createElement(v.Fragment,null,v.createElement("div",{className:e.headerContent},this.renderBackButtonSection(e),v.createElement("div",{className:e.headerContentGroup},this.renderSelectedVersionSection(e,n),this.renderButtonsSection(e,t)),v.createElement("div",{className:e.headerContentGroup},this.renderIteratorSection(e,r,o,i))))},t.prototype.renderBlankLoadLabel=function(e){return v.createElement(v.Fragment,null,v.createElement("div",{"aria-live":"polite",className:e.viewerNoSelection},v.createElement(Ce.a,{delay:50},v.createElement("div",null,this.props.localizedStrings.BlankLoadSelectVersionLabel))))},t.prototype.renderErrorHeader=function(e,t){return a.isChangeGateEnabled(l.FixFullAppErrorImage)?v.createElement(v.Fragment,null,v.createElement("div",{className:e.viewerError},v.createElement("img",{src:He(this.props.appSettings.appName),width:"62",height:"55"}),v.createElement("div",{className:e.viewerErrorMessage},this.props.localizedStrings.ViewerAreaErrorText)),v.createElement("div",{className:e.loadingDiv},v.createElement(V.a,{className:e.loadingSpinner,size:E.a.large}))):v.createElement(v.Fragment,null,v.createElement("div",{className:e.viewerError},v.createElement("img",{src:"https://static2.sharepointonline.com/files/fabric/assets/brand-icons/document/svg/"+t+"_48x1_5.svg",width:"62",height:"55"}),v.createElement("div",{className:e.viewerErrorMessage},this.props.localizedStrings.ViewerAreaErrorText)),v.createElement("div",{className:e.loadingDiv},v.createElement(V.a,{className:e.loadingSpinner,size:E.a.large})))},t}(v.PureComponent),Oe=Object(C.c)((function(e){return void 0===e&&(e="#B7472A"),{loadingSpinner:Object(S.eb)({selectors:{"& .ms-Spinner-circle":{borderColor:"#dddddd",borderTopColor:e}}})}})),Ne=r(1009),Be=r(318),je=r(688);!function(e){e[e.Hidden=1]="Hidden",e[e.CoauthRestoreDisplayed=2]="CoauthRestoreDisplayed",e[e.CoauthRestoreFailedServer=3]="CoauthRestoreFailedServer",e[e.CoauthRestoreInProgress=4]="CoauthRestoreInProgress"}(Re||(Re={}));var Le,Me=function(e){function t(t){return e.call(this,t)||this}return Object(o.__extends)(t,e),t.prototype.render=function(){var e=Oe(this.props.appColors.primary);switch(this.props.modalErrorState){case Re.CoauthRestoreDisplayed:return v.createElement(Ne.a,{hidden:!1,onDismiss:this.props.onDismiss,dialogContentProps:{type:Be.a.normal,title:this.props.localizedStrings.OtherEditors,subText:this.props.localizedStrings.OtherEditorsSubtext,showCloseButton:!1}},v.createElement(je.a,null,v.createElement(Ae,{text:this.props.localizedStrings.RestoreContinue,primaryClassName:"",id:"VHRestorContinue",onClick:this.props.onDismiss,isDisabled:!1,appColors:this.props.appColors})));case Re.CoauthRestoreInProgress:return v.createElement(Ne.a,{hidden:!1,isBlocking:!0,onDismiss:this.props.onDismiss,modalProps:{isModeless:!0,dragOptions:void 0},dialogContentProps:{type:Be.a.normal,title:this.props.localizedStrings.RestoreInProgress,showCloseButton:!1}},v.createElement(V.a,{className:e.loadingSpinner,size:E.a.large,ariaLabel:this.props.localizedStrings.RestoreInProgress}));case Re.CoauthRestoreFailedServer:return v.createElement(Ne.a,{hidden:!1,isBlocking:!0,onDismiss:this.props.onDismiss,dialogContentProps:{type:Be.a.normal,title:this.props.localizedStrings.RestoreFailed,subText:this.props.localizedStrings.RestoreFailedSubtext,showCloseButton:!1}},v.createElement(je.a,null,v.createElement(Ae,{text:this.props.localizedStrings.RestoreContinue,primaryClassName:"",id:"VHRestorContinue",onClick:this.props.refreshCallback,isDisabled:!1,appColors:this.props.appColors})));case Re.Hidden:default:return null}},t}(v.PureComponent);!function(e){e[e.Hidden=1]="Hidden",e[e.DeleteConfirmation=2]="DeleteConfirmation",e[e.DeleteInProgress=3]="DeleteInProgress",e[e.DeletePartialFailure=4]="DeletePartialFailure",e[e.DeleteFullFailure=5]="DeleteFullFailure"}(Le||(Le={}));var We=function(e){function t(t){return e.call(this,t)||this}return Object(o.__extends)(t,e),t.prototype.render=function(){var e=Oe(this.props.appColors.primary);switch(this.props.deleteModalErrorState){case Le.DeleteConfirmation:return v.createElement(Ne.a,{hidden:!1,onDismiss:this.props.onDismiss,dialogContentProps:{type:Be.a.normal,subText:1===this.props.revisionIDsToDeleteCount?this.props.localizedStrings.DeleteIndividualConfirmation:this.props.localizedStrings.DeleteGroupConfirmation.replace("{0}",this.props.revisionIDsToDeleteCount.toString()),title:this.props.localizedStrings.DeleteContinue}},v.createElement(je.a,null,v.createElement(Ae,{text:this.props.localizedStrings.Delete,primaryClassName:"",id:"VHDeleteContinue",onClick:this.props.deleteVersions,isDisabled:!1,appColors:this.props.appColors}),v.createElement(Ve,{text:this.props.localizedStrings.DeleteCancel,id:"VHDeleteCancel",className:"",onClick:this.props.onDismiss})));case Le.DeleteInProgress:return v.createElement(Ne.a,{hidden:!1,isBlocking:!0,dialogContentProps:{type:Be.a.normal,title:this.props.localizedStrings.Deleting}},v.createElement(V.a,{className:e.loadingSpinner,size:E.a.large,ariaLabel:"Deleting"}));case Le.DeletePartialFailure:return v.createElement(Ne.a,{hidden:!1,onDismiss:this.props.onDismiss,dialogContentProps:{type:Be.a.normal,title:this.props.localizedStrings.DeleteFailedPartialGroup,subText:this.props.localizedStrings.DeleteFailedPartialGroupFailureCount.replace("{0}",this.props.failedToDeleteCount.toString()).replace("{1}",this.props.revisionIDsToDeleteCount.toString())+" "+this.props.localizedStrings.DeleteFailedTryAgain}},v.createElement(je.a,null,v.createElement(Ae,{text:this.props.localizedStrings.BackLabel,primaryClassName:"",id:"VHDeletePartialFailure",onClick:this.props.onDismiss,isDisabled:!1,appColors:this.props.appColors})));case Le.DeleteFullFailure:return v.createElement(Ne.a,{hidden:!1,onDismiss:this.props.onDismiss,dialogContentProps:{type:Be.a.normal,title:1===this.props.revisionIDsToDeleteCount?this.props.localizedStrings.DeleteFailedIndividual:this.props.localizedStrings.DeleteFailedWholeGroup,subText:this.props.localizedStrings.DeleteFailedTryAgain}},v.createElement(je.a,null,v.createElement(Ae,{text:this.props.localizedStrings.BackLabel,primaryClassName:"",id:"VHDeleteFullFailure",onClick:this.props.onDismiss,isDisabled:!1,appColors:this.props.appColors})));case Le.Hidden:default:return null}},t}(v.PureComponent),ze=function(e){function t(t){var r=e.call(this,t)||this;return r._ftzone=v.createRef(),r._vhPane=v.createRef(),r._vhHeader=v.createRef(),r._dialogDescribedById=Object(b.a)(),r.renderVersionHistoryDialog=function(){var e=r.props.versions,t={localizedStrings:r.props.localizedStrings,selectedVersionId:r.props.selectedVersionId,selectedGroupName:r.props.selectedGroupName,totalChangesCount:r.props.totalChangesCount,currentChange:r.props.currentChange,onVersionSelectedAction:r.props.onVersionSelectedAction,onCloseSelectedAction:r.props.onCloseSelectedAction,onRestoreVersionAction:r.props.onRestoreVersionAction,onDeleteVersionsSelectedAction:r.props.onDeleteVersionsSelectedAction,paneLoading:r.props.paneLoading,viewerLoading:r.props.viewerLoading,viewerError:r.props.viewerError,fullAppError:r.props.fullAppError,appSettings:r.props.appSettings,appColors:r.props.appColors,modalErrorState:r.props.modalErrorState,deleteModalErrorState:r.props.deleteModalErrorState,refreshCallback:r.props.refreshCallback,revisionIDsToDeleteCount:r.props.revisionIDsToDeleteCount,failedToDeleteCount:r.props.failedToDeleteCount},n=_(t.appSettings.isRtl);return v.createElement(v.Fragment,null,r.props.fullAppError?v.createElement(v.Fragment,null,v.createElement("div",{className:n.fullAppErrorDiv},v.createElement(ke,Object(o.__assign)({versions:e},t,{getVersions:r.props.getVersions})))):v.createElement(v.Fragment,null,v.createElement(Me,Object(o.__assign)({versions:e},t,{onDismiss:r._onDismiss})),v.createElement(Fe,Object(o.__assign)({versions:e},t,{onSaveACopySelectedAction:r.props.onSaveACopySelectedAction,onRestoreVersionAction:r.props.onRestoreVersionAction,onIteratorSelectedAction:r.props.onIteratorSelectedAction,ref:r._vhHeader})),r.props.appSettings.wdEnableDeleteVersions?v.createElement(We,Object(o.__assign)({versions:e},t,{onDismiss:r._onDeleteDismiss,deleteVersions:r.props.deleteVersions})):v.createElement(v.Fragment,null),v.createElement(ye,Object(o.__assign)({versions:e},t,{onShowVersionChangesToggledAction:r.props.onShowVersionChangesToggledAction,onDownloadVersionSelectedAction:r.props.onDownloadVersionSelectedAction,onSaveACopySelectedAction:r.props.onSaveACopySelectedAction,onDeleteVersionsSelectedAction:r.props.onDeleteVersionsSelectedAction,ref:r._vhPane}))))},r.focus=function(){return r._vhPane.current&&r._vhPane.current.focus()},r.focusHeader=function(){r._vhHeader.current&&r._vhHeader.current.focusHeader()},r.focusSaveACopy=function(){r._vhHeader.current&&r._vhHeader.current.focusSaveACopy()},r._onDismiss=function(){t.setModalError(Re.Hidden)},r._onDeleteDismiss=function(){t.setDeleteModalError(Le.Hidden)},r}return Object(o.__extends)(t,e),t.prototype.render=function(){var e=_(this.props.appSettings.isRtl),t=this.props.localizedStrings;return v.createElement(fe.a,{componentRef:this._ftzone,className:e.root,forceFocusInsideTrap:!1,isClickableOutsideFocusTrap:!0,ignoreExternalFocusing:!0,focusPreviouslyFocusedInnerElement:!0,disableFirstFocus:!0,"aria-label":t.VersionHistoryTitle,"aria-describedby":this._dialogDescribedById,role:"group","aria-roledescription":t.VersionHistoryTitle},v.createElement("div",{className:e.dialog},this.renderVersionHistoryDialog(),v.createElement("div",{id:this._dialogDescribedById,className:e.hidden,"aria-hidden":!0},t.VersionHistoryTitle)))},t.prototype.focusViewer=function(){this._vhHeader.current&&this._vhHeader.current.focusViewer()},t}(v.PureComponent),Ue=r(165);var Ge,Pe=r(1701),qe=r(811),Ke=r(578);function Xe(e,t,r){return versionHistorySprite&&(versionHistorySprite.icons=versionHistorySprite.icons.map((function(e){return Object(o.__assign)(Object(o.__assign)({},e),{id:$(e.id)})})),Object(S.jb)({icons:Object(Ue.iconSpriteToReactMap)(versionHistorySprite)}),versionHistorySprite=void 0),new Promise((function(n){y.render(v.createElement(Je,Object(o.__assign)({ref:function(e){return n(e)}},t,r)),e)}))}!function(e){e[e.SelectOlderSubsection=1]="SelectOlderSubsection",e[e.SelectNewerSubsection=2]="SelectNewerSubsection",e[e.SelectOlderVersion=3]="SelectOlderVersion",e[e.SelectNewerVersion=4]="SelectNewerVersion",e[e.SelectTipSubsection=5]="SelectTipSubsection",e[e.SelectTipVersion=6]="SelectTipVersion"}(Ge||(Ge={}));var Je=function(e){function t(t){var r=e.call(this,t)||this;return r._dialog=v.createRef(),r.selectedVersionId=null,r.onVersionSelectedAction=function(e){if(e.currentVersion&&e.currentVersion.RevisionID){if(n.a.sendTraceTag(595933192,i.a.msoulscat_Wac_VersionHistory,s.a.Info,r.getLoggableVersionInfoString("onVersionSelectedAction - Version selected in pane",e.currentVersion.RevisionID,r.state)),r.selectedVersionId=e.currentVersion.RevisionID?e.currentVersion.RevisionID:void 0,e.currentVersion.DownloadUrl)n.a.sendTraceTag(595907534,i.a.msoulscat_Wac_VersionHistory,s.a.Info,r.getLoggableVersionInfoString("selectVersion - Version selected in pane",e.currentVersion.RevisionID,r.state)),r.setState({selectedVersionId:r.selectedVersionId,selectedGroupName:e.groupName?e.groupName:void 0,viewerError:!1,viewerLoading:!!r.props.appSettings.wdEnableHiddenButtonsUntilVersionLoadComplete},(function(){return r.props.onVersionSelectedAction(e)}));else{r.setState({selectedVersionId:r.selectedVersionId,viewerError:!1,viewerLoading:!0});var t=[e.currentVersion.RevisionID];e.baseVersion&&e.baseVersion.RevisionID&&t.push(e.baseVersion.RevisionID),r.props.getDownloadToken(t,e)}if(e.currentVersion.DownloadUrl&&e.baseVersion&&e.baseVersion.RevisionID&&!e.baseVersion.DownloadUrl){t=[e.currentVersion.RevisionID,e.baseVersion.RevisionID];r.props.getDownloadToken(t,e)}}},r.onCloseSelectedAction=function(){r.props.onCloseSelectedAction(),r.resetState(),r.disableSearchBar(!1)},r.onSaveACopySelectedAction=function(e){n.a.sendTraceTag(595903688,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,r.getLoggableVersionInfoString("onSaveACopySelectedAction",r.state.selectedVersionId,r.state)),r.props.onSaveACopySelectedAction(e)},r.onDownloadVersionSelectedAction=function(e){n.a.sendTraceTag(593072918,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,r.getLoggableVersionInfoString("onDownloadVersionSelectedAction",r.state.selectedVersionId,r.state)),r.props.onDownloadVersionSelectedAction(e)},r.onRestoreVersionAction=function(e){n.a.sendTraceTag(595892446,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,r.getLoggableVersionInfoString("onRestoreVersionAction",e,r.state)),r.props.onRestoreVersionAction(e)},r.onDeleteVersionsSelectedAction=function(e){n.a.sendTraceTag(590147609,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,1===e.length?r.getLoggableVersionInfoString("onDeleteVersionsSelectedAction",e[0],r.state):r.getLoggableVersionInfoString("onDeleteVersionsSelectedAction with {0} versions, info for most recent version in group".replace("{0}",e.length.toString()),e[0],r.state));var t=e.length;r.setState({revisionIDsToDeleteCount:t}),r.props.onDeleteVersionsSelectedAction(e)},r.getInitState=function(){return{versions:[],selectedVersionId:void 0,selectedGroupName:void 0,totalChangesCount:0,currentChange:0,paneLoading:!0,viewerLoading:!0,viewerError:!1,fullAppError:0,modalErrorState:Re.Hidden,deleteModalErrorState:Le.Hidden,revisionIDsToDeleteCount:0,failedToDeleteCount:0,refreshCallback:function(){}}},r.resetState=function(){r.setState(r.getInitState())},r.getAgeOfTime=function(e){return Date.now()-e.getTime()},r.getVersionInfoFromId=function(e,t){if(e){var r=Object(be.e)(t.versions,(function(t){return t.RevisionID===e}));return r>=0?{version:t.versions[r],index:r}:void 0}},r.getLoggableVersionInfoString=function(e,t,o){var n=r.getVersionInfoFromId(t,o);if(n){var i=n.version,s=n.index,a=i.Time?r.getAgeOfTime(i.Time):"-1";return JSON.stringify({msg:e,revisionId:i.RevisionID,revisionAge:a,revisionIndex:s})}return""},r.getGroupTipFromVersion=function(e,t){if(t<0||t>e.length)return n.a.sendTraceTag(589312481,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"getGroupTipFromVersion: index out of bounds: currIndex = {0}".replace("{0}",t.toString())),e[0];if(0===t)return e[0];var o=e[t],a=t-1,l=e[a];for(a-=1;l&&r.areVersionsInSameGroup(o,l);)o=l,l=e[a],a-=1;return o},r.areVersionsInSameGroup=function(e,t){var r,o,n,i,s,a;return e===t||(null===(r=null==e?void 0:e.Time)||void 0===r?void 0:r.getDate())===(null===(o=null==t?void 0:t.Time)||void 0===o?void 0:o.getDate())&&(null===(n=null==e?void 0:e.Time)||void 0===n?void 0:n.getMonth())===(null===(i=null==t?void 0:t.Time)||void 0===i?void 0:i.getMonth())&&(null===(s=null==e?void 0:e.Time)||void 0===s?void 0:s.getFullYear())===(null===(a=null==t?void 0:t.Time)||void 0===a?void 0:a.getFullYear())},r.showDeleteFullOrPartialFailure=function(e,t){return e<=0?(n.a.sendTraceTag(589312482,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"showDeleteFullOrPartialFailure: no versions to delete: toDelete = {0}".replace("{0}",e.toString())),!0):e===t?(r.setDeleteModalError(Le.DeleteFullFailure),!0):(t>0&&(r.setState({failedToDeleteCount:t}),r.setDeleteModalError(Le.DeletePartialFailure)),!1)},r.removeVersions=function(e,t){var o=e.filter((function(e){return!t.includes(e)}));return r.state.versions.filter((function(e){return!e.RevisionID||!o.includes(e.RevisionID)}))},r.selectAfterDelete=function(e,t,o){var a,l;if(0===e)return n.a.sendTraceTag(589312483,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"selectAfterDelete: attempting to delete tip version"),r.props.appSettings.wdEnableCompareVersionsByGroup?Ge.SelectTipSubsection:Ge.SelectTipVersion;if(e<0||e-1>=t.length)return n.a.sendTraceTag(589312512,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"selectAfterDelete: firstIndexDeleted out of bounds: currIndex = {0}".replace("{0}",e.toString())),r.props.appSettings.wdEnableCompareVersionsByGroup?Ge.SelectTipSubsection:Ge.SelectTipVersion;a=t[e-1],l=e>=t.length?void 0:t[e];var c=r.state.versions[e];return r.props.appSettings.wdEnableCompareVersionsByGroup?o?l?Ge.SelectOlderSubsection:Ge.SelectNewerSubsection:r.areVersionsInSameGroup(c,l)?Ge.SelectOlderVersion:r.areVersionsInSameGroup(c,a)?Ge.SelectNewerVersion:l?Ge.SelectOlderSubsection:Ge.SelectNewerSubsection:l?Ge.SelectOlderVersion:Ge.SelectNewerVersion},r.state=r.getInitState(),r.setModalError=r.setModalError.bind(r),r.setDeleteModalError=r.setDeleteModalError.bind(r),r.setRefreshCallback=r.setRefreshCallback.bind(r),r.disableSearchBar(!0),n.a.sendTraceTag(595933189,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"Pane constructed"),r}return Object(o.__extends)(t,e),t.prototype.insertVersions=function(e){n.a.sendTraceTag(595933190,i.a.msoulscat_Wac_VersionHistory,s.a.Info,JSON.stringify({msg:"insertVersions",count:e.length})),this.setState({versions:e})},t.prototype.insertVersionsAndClearPaneLoading=function(e){n.a.sendTraceTag(592066070,i.a.msoulscat_Wac_VersionHistory,s.a.Info,JSON.stringify({msg:"insertVersions and clear pane loading",count:e.length})),this.setState({versions:e,paneLoading:!1})},t.prototype.insertVersionsAndClearLoading=function(e){n.a.sendTraceTag(592066071,i.a.msoulscat_Wac_VersionHistory,s.a.Info,JSON.stringify({msg:"insertVersions and clear pane and viewer loading",count:e.length})),this.setState({versions:e,paneLoading:!1,viewerLoading:!1})},t.prototype.removeVersionsAndSelectNext=function(e,t){n.a.sendTraceTag(589939200,i.a.msoulscat_Wac_VersionHistory,s.a.Info,JSON.stringify({msg:"removeVersionsAndSelectNext",count:e.length-t.length}));var r=!1,o=!1;if(!(t.length>0&&(o=!(r=this.showDeleteFullOrPartialFailure(e.length,t.length)),r))){var a=this.state.versions.findIndex((function(t){return t.RevisionID===e[0]})),l=this.removeVersions(e,t),c=this.selectAfterDelete(a,l,o),p=l[a],d=l[a+1],u=l[a-1],h=p;switch(c){case Ge.SelectTipVersion:this.setVersionsAndSelectVersion(l,{currentVersion:l[0],baseVersion:l[1],noBaseToCompareTo:!l[1]});break;case Ge.SelectTipSubsection:this.setVersionsAndSelectSubSection(l,l[0]);break;case Ge.SelectOlderVersion:this.setVersionsAndSelectVersion(l,{currentVersion:p,baseVersion:d,noBaseToCompareTo:!d});break;case Ge.SelectNewerVersion:this.setVersionsAndSelectVersion(l,{currentVersion:u,baseVersion:h,noBaseToCompareTo:!h});break;case Ge.SelectOlderSubsection:this.setVersionsAndSelectSubSection(l,p);break;case Ge.SelectNewerSubsection:this.setVersionsAndSelectSubSection(l,this.getGroupTipFromVersion(l,a-1))}o||this.setDeleteModalError(Le.Hidden)}},t.prototype.setVersionsAndSelectSubSection=function(e,t){this._dialog&&this._dialog.current&&t?(n.a.sendTraceTag(592066072,i.a.msoulscat_Wac_VersionHistory,s.a.Info,JSON.stringify({msg:"insertVersions and select subsection",count:e.length})),this.setState({versions:e,paneLoading:!1,selectedGroupName:t.RevisionID?t.RevisionID:void 0})):(n.a.sendTraceTag(592066073,i.a.msoulscat_Wac_VersionHistory,s.a.Info,JSON.stringify({msg:"insertVersions and clear pane loading",count:e.length})),this.setState({versions:e,paneLoading:!1}))},t.prototype.setTotalChangesCount=function(e){this._dialog&&this._dialog.current&&this.setState({totalChangesCount:e})},t.prototype.setCurrentChangeCount=function(e){this._dialog&&this._dialog.current&&this.setState({currentChange:e})},t.prototype.setViewerLoading=function(e){this.setState({viewerLoading:e})},t.prototype.setViewerError=function(e){this.setState({viewerError:e})},t.prototype.setFullAppErrorCode=function(e){this.setState({fullAppError:e})},t.prototype.hitFullAppError=function(e){this.setState({fullAppError:e,viewerLoading:!1,paneLoading:!1,viewerError:!1})},t.prototype.disableSearchBar=function(e){Object(qe.a)(Ke.a)(Object(Pe.a)(e))},t.prototype.getVersionsTriggered=function(){this.resetState(),this.disableSearchBar(!0)},t.prototype.setModalError=function(e){this.setState({modalErrorState:e})},t.prototype.setDeleteModalError=function(e){this.setState({deleteModalErrorState:e})},t.prototype.setRefreshCallback=function(e){this.setState({refreshCallback:e})},t.prototype.setRestoreFailedAtServer=function(e,t){this.setState({modalErrorState:e,refreshCallback:t})},t.prototype.setVersionsAndSelectVersion=function(e,t){var r=this;if(t.currentVersion&&t.currentVersion.RevisionID){var o=this.state.viewerLoading;n.a.sendTraceTag(595907534,i.a.msoulscat_Wac_VersionHistory,s.a.Info,this.getLoggableVersionInfoString("selectVersion - Version selected in pane",t.currentVersion.RevisionID,this.state)),this.selectedVersionId=t.currentVersion.RevisionID;var a=this.selectedVersionId,l=t.groupName?t.groupName:void 0;o=!!this.props.appSettings.wdEnableHiddenButtonsUntilVersionLoadComplete,n.a.sendTraceTag(592066074,i.a.msoulscat_Wac_VersionHistory,s.a.Info,JSON.stringify({msg:"insertVersions during select",count:e.length})),this.setState({versions:e,paneLoading:!1,viewerLoading:o,selectedVersionId:a,selectedGroupName:l,viewerError:!1},(function(){return r.props.onVersionSelectedAction(t)}))}},t.prototype.render=function(){return v.createElement(ze,Object(o.__assign)({ref:this._dialog,setModalError:this.setModalError,setDeleteModalError:this.setDeleteModalError,setRefreshCallback:this.setRefreshCallback},this.props,this.state,{onVersionSelectedAction:this.onVersionSelectedAction,onCloseSelectedAction:this.onCloseSelectedAction,onSaveACopySelectedAction:this.onSaveACopySelectedAction,onDownloadVersionSelectedAction:this.onDownloadVersionSelectedAction,onRestoreVersionAction:this.onRestoreVersionAction,onDeleteVersionsSelectedAction:this.onDeleteVersionsSelectedAction,getVersions:this.props.getVersions,deleteVersions:this.props.deleteVersions,appColors:this.props.appColors,setSaveACopyCanceled:this.setSaveACopyCanceled}))},t.prototype.enterFocusTrapZone=function(){this._dialog.current&&this._dialog.current.focus()},t.prototype.enterHeaderFocusTrapZone=function(){this._dialog.current&&this._dialog.current.focusHeader()},t.prototype.setSaveACopyCanceled=function(){this._dialog.current&&this._dialog.current.focusSaveACopy()},t.prototype.enterViewerFocusTrapZone=function(){this._dialog.current&&this._dialog.current.focusViewer()},t}(v.PureComponent),Ye={shade30:"#0e336a",shade20:"#13458f",shade10:"#1651aa",primary:"#185abd",tint10:"#2e6ac5",tint20:"#6794d7",tint30:"#aec6eb",tint40:"#d2e0f4"},Ze={shade30:"#0e336a",shade20:"#002050",shade10:"#124078",primary:"#2b579a",tint10:"#3c65a4",tint20:"#4a78b0",tint30:"#7da3c6",tint40:"#a5b9d1"},Qe={shade30:"#6e220f",shade20:"#740912",shade10:"#a92b1a",primary:"#b7472a",tint10:"#c75033",tint20:"#e86e58",tint30:"#ed9583",tint40:"#fdc9b5"},$e={shade30:"#094624",shade20:"#0C5F32",shade10:"#0F703B",primary:"#107C41",tint10:"#218D51",tint20:"#55B17E",tint30:"#A0D8B9",tint40:"#CAEAD8"};var et=function(){function e(e,t,r,o,i,s,l,c){this._onVersionsReadyEvent=new f,this._onDownloadTokenReadyEvent=new f,this._fullAppErrorEvent=new f,this._onVersionSelectedEvent=new f,this._onTipVersionTokenReadyEvent=new f,this._onCloseSelectedEvent=new f,this._onSaveACopySelectedEvent=new f,this._onDownloadVersionSelectedEvent=new f,this._onRestoreVersionSelectedEvent=new f,this._onIteratorSelectedEvent=new f,this._onAppRefreshTriggeredEvent=new f,this._onShowVersionChangesToggledEvent=new f,n.a.setLogger(t),this._perfTelemetryInfos=c,this._appSettings=l||{appName:0,fileExtension:"",wdEnableDownloadTokens:!1,retryCount:3,wdEnableSaveACopy:!1,wdEnableRestore:!1,wdEnableIterator:!1,userSessionId:"",wacCluster:"",uiLocale:"en-us",isRtl:!1,useXhr:!1,viewerRootPositionRelative:!1,wdEnableHiddenButtonsUntilVersionLoadComplete:!1,wdEnableShowVersionChanges:!1,disableSaveACopy:!1,wdEnableCompareVersionsByGroup:!1,wdEnableShowVersionEvents:!1,disabledChangeGates:"",wdEnableDownloadVersion:!1,wdLoadBlankVersionOnOpen:!1,wdEnableAppColorUpdate:!1},h.UILocale=this._appSettings.uiLocale,this._versionHistoryStringsBag=e,this._versionHistoryCache=new m(this._onVersionsReadyEvent,this._onDownloadTokenReadyEvent,this._fullAppErrorEvent,this._onTipVersionTokenReadyEvent,r,o,this._appSettings,i,s,this._perfTelemetryInfos),this._revisionIDsToDelete=[],this._onVersionsReadyEvent.addListener(this.onVersionsReady.bind(this)),this._onDownloadTokenReadyEvent.addListener(this.onDownloadTokenReady.bind(this)),this._fullAppErrorEvent.addListener(this.fullAppError.bind(this)),this._onTipVersionTokenReadyEvent.addListener(this.onTipVersionTokenReady.bind(this)),a.setDisabledChangeGates(this._appSettings.disabledChangeGates||"")}return e.prototype.createVersionHistoryDialog=function(e){var t=this,r=Date.now();if(n.a.sendTraceTag(590144343,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,JSON.stringify({event:"createVersionHistoryDialog: started",startTime:r,wdLoadBlankVersionOnOpen:this._appSettings.wdLoadBlankVersionOnOpen})),e){null!=this._perfTelemetryInfos&&this._perfTelemetryInfos.push({TelemetryEventKey:"CreateVersionHistoryDialogStart",TelemetryEventData:r.toString()});var o={onVersionSelectedAction:this._onVersionSelectedEvent.fireEvent.bind(this._onVersionSelectedEvent),onCloseSelectedAction:this._onCloseSelectedEvent.fireEvent.bind(this._onCloseSelectedEvent),onSaveACopySelectedAction:this._onSaveACopySelectedEvent.fireEvent.bind(this._onSaveACopySelectedEvent),onDownloadVersionSelectedAction:this._onDownloadVersionSelectedEvent.fireEvent.bind(this._onDownloadVersionSelectedEvent),onRestoreVersionAction:this._onRestoreVersionSelectedEvent.fireEvent.bind(this._onRestoreVersionSelectedEvent),onDeleteVersionsSelectedAction:function(e){return t.onDeleteVersionsSelectedEvent(e)},onIteratorSelectedAction:this._onIteratorSelectedEvent.fireEvent.bind(this._onIteratorSelectedEvent),onShowVersionChangesToggledAction:this._onShowVersionChangesToggledEvent.fireEvent.bind(this._onShowVersionChangesToggledEvent),getVersions:function(){return t.getVersions()},getDownloadToken:function(e,r){return t.getDownloadToken(e,r)},deleteVersions:function(){return t.deleteVersions()}},a=Ze;if(this._appSettings.appName)switch(this._appSettings.appName){case 110:a=!!this._appSettings.wdEnableAppColorUpdate?Ye:Ze;break;case 100:a=Qe;break;case 120:a=$e;break;default:n.a.sendTraceTag(592548236,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"invalid app name used"+this._appSettings.appName)}else n.a.sendTraceTag(592548237,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"no app name was passed in");return Xe(e,{localizedStrings:this._versionHistoryStringsBag,appSettings:this._appSettings,appColors:a},o).then((function(e){return t._versionHistoryDialog=e,t._versionHistoryDialog.insertVersions(t._versionHistoryCache.Versions),null!=t._perfTelemetryInfos&&t._perfTelemetryInfos.push({TelemetryEventKey:"CreateVersionHistoryDialogEnd",TelemetryEventData:Date.now().toString()}),n.a.sendTraceTag(590144344,i.a.msoulscat_Wac_VersionHistory,s.a.Warning,JSON.stringify({event:"createVersionHistoryDialog: ended",error:"None",startTime:r,duration:Date.now()-r,versionCount:t._versionHistoryCache.Versions.length})),e}))}return n.a.sendTraceTag(590144345,i.a.msoulscat_Wac_VersionHistory,s.a.Error,JSON.stringify({event:"createVersionHistoryDialog: ended",error:"no containerElement",startTime:r,duration:Date.now()-r})),Promise.reject(void 0)},e.prototype.getTipVersion=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._versionHistoryCache.getTipVersion()];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),n.a.sendTraceTag(591680147,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"VersionHistoryController.getTipVersion: unexpected exception, error: "+e.message),[3,3];case 3:return[2]}}))}))},e.prototype.getVersions=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(t){switch(t.label){case 0:this._versionHistoryDialog&&this._versionHistoryDialog.getVersionsTriggered(),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._versionHistoryCache.getVersions()];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),n.a.sendTraceTag(591680148,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"VersionHistoryController.getVersions: unexpected exception, error: "+e.message),[3,4];case 4:return[2]}}))}))},e.prototype.setVersionLoadComplete=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return this._versionHistoryDialog&&(n.a.sendTraceTag(588335171,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"Version done loading"),this._versionHistoryDialog.setViewerLoading(!1)),[2]}))}))},e.prototype.setTotalChangesCount=function(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){return this._versionHistoryDialog&&(n.a.sendTraceTag(595658889,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"setTotalChangesCount with count:"+e.toString()),this._versionHistoryDialog.setTotalChangesCount(e)),[2]}))}))},e.prototype.setCurrentChangeCount=function(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){return this._versionHistoryDialog&&(n.a.sendTraceTag(595658890,i.a.msoulscat_Wac_VersionHistory,s.a.Info,"setCurrentChangeCount with count:"+e.toString()),this._versionHistoryDialog.setCurrentChangeCount(e)),[2]}))}))},e.prototype.setFullAppErrorCode=function(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){return this._versionHistoryDialog&&this._versionHistoryDialog.setFullAppErrorCode(e),[2]}))}))},e.prototype.setViewerError=function(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){return e&&n.a.sendTraceTag(587309088,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"setViewerError with true"),this._versionHistoryDialog&&this._versionHistoryDialog.setViewerError(e),[2]}))}))},e.prototype.setCoauthRestoreError=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return this._versionHistoryDialog&&(this._versionHistoryDialog.setModalError(Re.Hidden),this._versionHistoryDialog.setModalError(Re.CoauthRestoreDisplayed)),[2]}))}))},e.prototype.setRestoreFailedAtServer=function(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){return this._versionHistoryDialog&&e&&this._versionHistoryDialog.setRestoreFailedAtServer(Re.CoauthRestoreFailedServer,e),[2]}))}))},e.prototype.setRestoreInProgress=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return this._versionHistoryDialog&&this._versionHistoryDialog.setModalError(Re.CoauthRestoreInProgress),[2]}))}))},e.prototype.setDeleteConfirmation=function(){this._versionHistoryDialog&&this._versionHistoryDialog.setDeleteModalError(Le.DeleteConfirmation)},e.prototype.setDeleteInProgress=function(){this._versionHistoryDialog&&this._versionHistoryDialog.setDeleteModalError(Le.DeleteInProgress)},e.prototype.setDeletePartialFailure=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return this._versionHistoryDialog&&this._versionHistoryDialog.setDeleteModalError(Le.DeletePartialFailure),[2]}))}))},e.prototype.setDeleteFullFailure=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return this._versionHistoryDialog&&this._versionHistoryDialog.setDeleteModalError(Le.DeleteFullFailure),[2]}))}))},e.prototype.setDisableSaveACopy=function(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){return this._appSettings&&(this._appSettings.disableSaveACopy=e),[2]}))}))},e.prototype.setSaveACopyCanceled=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return this._appSettings.wdEnableSaveACopyOverFlowMenu||this._versionHistoryDialog&&this._versionHistoryDialog.setSaveACopyCanceled(),[2]}))}))},e.prototype.getDownloadToken=function(e,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var r;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:if(!this._versionHistoryDialog)return[3,4];this._versionHistoryDialog.setFullAppErrorCode(0),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._versionHistoryCache.getDownloadToken(e,t)];case 2:return o.sent(),[3,4];case 3:return r=o.sent(),n.a.sendTraceTag(591680149,i.a.msoulscat_Wac_VersionHistory,s.a.Error,"VersionHistoryController.getDownloadToken: unexpected exception, error: "+r.message),[3,4];case 4:return[2]}}))}))},e.prototype.deleteVersions=function(){var e,t;return Object(o.__awaiter)(this,void 0,void 0,(function(){var r;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return this.setDeleteInProgress(),[4,this._versionHistoryCache.deleteVersions(this._revisionIDsToDelete)];case 1:return r=o.sent(),null===(e=this._versionHistoryDialog)||void 0===e||e.setDeleteModalError(Le.Hidden),r&&(null===(t=this._versionHistoryDialog)||void 0===t||t.removeVersionsAndSelectNext(this._revisionIDsToDelete,r)),[2]}}))}))},e.prototype.getVersionSelectedEvent=function(){return this._onVersionSelectedEvent},e.prototype.getCloseSelectedEvent=function(){return this._onCloseSelectedEvent},e.prototype.getSaveACopySelectedEvent=function(){return this._onSaveACopySelectedEvent},e.prototype.getDownloadVersionSelectedEvent=function(){return this._onDownloadVersionSelectedEvent},e.prototype.getRestoreVersionSelectedEvent=function(){return this._onRestoreVersionSelectedEvent},e.prototype.getIteratorSelectedEvent=function(){return this._onIteratorSelectedEvent},e.prototype.getVersionsReadyEvent=function(){return this._onVersionsReadyEvent},e.prototype.getAppRefreshTriggeredEvent=function(){return this._onAppRefreshTriggeredEvent},e.prototype.getDownloadTokenReadyEvent=function(){return this._onDownloadTokenReadyEvent},e.prototype.getTipVersionTokenReadyEvent=function(){return this._onTipVersionTokenReadyEvent},e.prototype.getFullAppErrorEvent=function(){return this._fullAppErrorEvent},e.prototype.getShowVersionChangesToggledEvent=function(){return this._onShowVersionChangesToggledEvent},e.prototype.onVersionsReady=function(e){if(this._versionHistoryDialog&&e&&e.versions)if(this._appSettings.wdLoadBlankVersionOnOpen)this._versionHistoryDialog.insertVersionsAndClearLoading(e.versions.filter((function(e){return e})));else if(e.versions[0])if(this._appSettings.wdEnableCompareVersionsByGroup)this._versionHistoryDialog.setVersionsAndSelectSubSection(e.versions.filter((function(e){return e})),e.versions[0]);else{var t=e.versions[1]?e.versions[1]:null,r=[];e.versions[0].DownloadUrl?this._versionHistoryDialog.setVersionsAndSelectVersion(e.versions.filter((function(e){return e})),{currentVersion:e.versions[0],baseVersion:t,correlationID:e.correlationID,noBaseToCompareTo:!t}):this._versionHistoryDialog.selectedVersionId=e.versions[0].RevisionID,(!e.versions[0].DownloadUrl||this._versionHistoryCache._tipVersionResponse&&this._versionHistoryCache._tipVersionResponse.data&&e.versions[0].DownloadUrl===this._versionHistoryCache._tipVersionResponse.data.DownloadUrl)&&r.push(e.versions[0].RevisionID),e.versions[1]&&!e.versions[1].DownloadUrl&&r.push(e.versions[1].RevisionID),r.length>0&&this._versionHistoryCache.getDownloadToken(r,{currentVersion:e.versions[0],baseVersion:t,noBaseToCompareTo:!t})}else this._versionHistoryDialog.insertVersionsAndClearPaneLoading(e.versions.filter((function(e){return e})))},e.prototype.onDownloadTokenReady=function(e){if(this._versionHistoryDialog&&e&&e.updatedVersions){var t=e.updatedVersions.filter((function(e){return e}));!e.versionSelected||!e.versionSelected.currentVersion||this._versionHistoryDialog.selectedVersionId&&this._versionHistoryDialog.selectedVersionId!==e.versionSelected.currentVersion.RevisionID?this._versionHistoryDialog.insertVersions(t):this._versionHistoryDialog.setVersionsAndSelectVersion(t,e.versionSelected)}},e.prototype.onTipVersionTokenReady=function(e){if(this._versionHistoryDialog&&e&&e.tipVersion&&e.tipVersion.DownloadUrl&&e.updatedVersions&&e.updatedVersions[0]&&e.tipVersion.DownloadUrl===e.updatedVersions[0].DownloadUrl){var t=e.updatedVersions.filter((function(e){return e}));this._versionHistoryDialog.selectedVersionId&&this._versionHistoryDialog.selectedVersionId!==e.updatedVersions[0].RevisionID?this._versionHistoryDialog.insertVersions(t):this._versionHistoryDialog.setVersionsAndSelectVersion(t,{currentVersion:e.updatedVersions[0],noBaseToCompareTo:!1})}},e.prototype.onDeleteVersionsSelectedEvent=function(e){this._revisionIDsToDelete=e,this.setDeleteConfirmation()},e.prototype.fullAppError=function(e){this._versionHistoryDialog&&this._versionHistoryDialog.hitFullAppError(e)},e}(),tt=function(){function e(){}return e.createVersionHistoryController=function(e,t,r,n,i,s,a){var l=Object(o.__assign)(Object(o.__assign)({},OfficeVersionHistoryStrings),FriendlyDatesStrings);return new et(l,e,t,r,n,i,s,a)},e}(),rt=new(function(){function e(){}return e.prototype.getVersionHistoryControllerInstance=function(e){if(e&&e.docId&&e.ulsLogger)return tt.createVersionHistoryController(e.ulsLogger,null===e.serviceBase||void 0===e.serviceBase?"":e.serviceBase,e.docId,null===e.latestStreamServiceBase||void 0===e.latestStreamServiceBase?"":e.latestStreamServiceBase,void 0,e.appSettings,e.perfTelemetryInfos)},e}());r.d(t,"FactoryGlobal",(function(){return rt}))},183:function(e,t){e.exports={CancelGlyph_16:"CancelGlyph_16",ArrowStyle3_20:"ArrowStyle3_20",ArrowBack_20:"ArrowBack_20",BackChevronPaddle_24:"BackChevronPaddle_24",NextChevronPaddle_24:"NextChevronPaddle_24",CommonControlChevronRight_16:"CommonControlChevronRight_16",CommonControlChevronLeft_16:"CommonControlChevronLeft_16",CommonControlChevronDown_16:"CommonControlChevronDown_16",UpChevronMedium_20:"UpChevronMedium_20",DownChevronMedium_20:"DownChevronMedium_20",CommonControlMore_12:"CommonControlMore_12",Ellipsis_12:"Ellipsis_12",HintBarEllipses_20:"HintBarEllipses_20",CommonControlChevronDown_8:"CommonControlChevronDown_8",CommonControlChevronDownGlyph_12:"CommonControlChevronDownGlyph_12",CommonControlChevronUp_8:"CommonControlChevronUp_8",CommonControlChevronRight_12:"CommonControlChevronRight_12",CommonControlChevronRight_16:"CommonControlChevronRight_16",CommonControlChevronLeft_16:"CommonControlChevronLeft_16",CommonControlCheckboxCheck_16:"CommonControlCheckboxCheck_16",CheckmarkWithDynamicColor_16:"CheckmarkWithDynamicColor_16",CommonControlDialogLauncher_8:"CommonControlDialogLauncher_8"}},97:function(e,t){e.exports=otel}},[[1482,2,0,1]]]);
//# sourceMappingURL=versionHistory.min.js.map